<!DOCTYPE html>
<html>
<head>
    <title>App Health Check</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        .check-item { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Advanced Retirement Planner - Health Check</h1>
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        const checks = [];
        
        function addCheck(name, status, details) {
            const div = document.createElement('div');
            div.className = 'check-item';
            div.innerHTML = `
                <h3 class="${status}">${status === 'success' ? '✓' : status === 'error' ? '✗' : '⚠'} ${name}</h3>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            results.appendChild(div);
        }
        
        async function runHealthChecks() {
            // Check 1: Main page loads
            try {
                const response = await fetch('http://localhost:8085/');
                addCheck('Main Page Load', response.ok ? 'success' : 'error', 
                    `Status: ${response.status} ${response.statusText}`);
            } catch (e) {
                addCheck('Main Page Load', 'error', e.message);
            }
            
            // Check 2: Required scripts
            const scripts = [
                'src/utils/consoleInterceptor.js',
                'src/utils/fullAppInitializer.js',
                'src/components/core/RetirementPlannerApp.js',
                'src/utils/retirementCalculations.js'
            ];
            
            for (const script of scripts) {
                try {
                    const url = `http://localhost:8085/${script}?v=7.5.10`;
                    const response = await fetch(url);
                    addCheck(`Script: ${script}`, response.ok ? 'success' : 'error',
                        `Status: ${response.status}`);
                } catch (e) {
                    addCheck(`Script: ${script}`, 'error', e.message);
                }
            }
            
            // Check 3: External CDNs
            const cdns = [
                { name: 'React', url: 'https://unpkg.com/react@18/umd/react.development.js' },
                { name: 'ReactDOM', url: 'https://unpkg.com/react-dom@18/umd/react-dom.development.js' },
                { name: 'Chart.js', url: 'https://cdn.jsdelivr.net/npm/chart.js' }
            ];
            
            for (const cdn of cdns) {
                try {
                    const response = await fetch(cdn.url, { method: 'HEAD' });
                    addCheck(`CDN: ${cdn.name}`, response.ok ? 'success' : 'warning',
                        `Status: ${response.status} - Consider local fallback`);
                } catch (e) {
                    addCheck(`CDN: ${cdn.name}`, 'warning', 
                        `CORS issue or network error - ${e.message}`);
                }
            }
            
            // Check 4: API endpoints
            addCheck('Currency API', 'warning', 
                'External API - will use fallback rates if unavailable');
            addCheck('Stock Price API', 'warning', 
                'External API - will use fallback prices if unavailable');
            
            // Check 5: Load the actual app in an iframe
            const iframe = document.createElement('iframe');
            iframe.style.width = '100%';
            iframe.style.height = '600px';
            iframe.style.border = '1px solid #ccc';
            iframe.style.marginTop = '20px';
            
            const iframeDiv = document.createElement('div');
            iframeDiv.innerHTML = '<h2>Live Application Preview:</h2>';
            iframeDiv.appendChild(iframe);
            results.appendChild(iframeDiv);
            
            // Add debug mode to capture console
            iframe.src = 'http://localhost:8085/?debug=true';
            
            iframe.onload = function() {
                addCheck('Application Loaded', 'success', 
                    'Check browser console (F12) for any runtime errors');
            };
            
            iframe.onerror = function() {
                addCheck('Application Load', 'error', 'Failed to load in iframe');
            };
        }
        
        // Run checks
        runHealthChecks();
    </script>
</body>
</html>