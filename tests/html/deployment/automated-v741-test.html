<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automated v7.4.1 Test - One Command</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        h1 {
            color: #333;
            margin: 0 0 20px 0;
        }
        .command-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            position: relative;
            overflow-x: auto;
            cursor: pointer;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .copy-btn {
            position: absolute;
            right: 10px;
            top: 10px;
            background: #28a745;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 10px 10px 0;
        }
        button:hover {
            background: #0056b3;
        }
        .instructions {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Automated v7.4.1 Test - One Command</h1>
        <p>Copy and paste this single command into the console. It will run all tests automatically and show you the results.</p>
        
        <button onclick="window.open('https://ypollak2.github.io/advanced-retirement-planner/', '_blank')">
            Open Production App
        </button>
        
        <div class="instructions">
            <strong>Instructions:</strong>
            <ol>
                <li>Click the button above to open the production app</li>
                <li>Press F12 to open developer console</li>
                <li>Click the "Copy" button below</li>
                <li>Paste into console and press Enter</li>
                <li>Wait ~2 seconds for results</li>
            </ol>
        </div>
    </div>

    <div class="container">
        <h2>üéØ The Ultimate Test Command</h2>
        <p>This single command runs all tests and gives you a clear pass/fail result:</p>
        
        <div class="command-block" onclick="copyToClipboard(this)">
// üöÄ AUTOMATED v7.4.1 FIX VERIFICATION TEST
(function runComprehensiveTest() {
    console.clear();
    console.log('üöÄ RUNNING AUTOMATED v7.4.1 VERIFICATION TEST...\n');
    
    // Test configuration
    const testResults = {
        functionAvailability: { pass: true, details: [] },
        returnFormat: { pass: true, details: [] },
        individualFactors: { pass: true, details: [] },
        fullCalculation: { pass: true, score: 0, details: [] }
    };
    
    // Test data
    const testData = {
        planningType: 'individual',
        currentAge: 35,
        retirementAge: 67,
        currentMonthlySalary: 50000,
        currentMonthlyExpenses: 25000,
        currentPension: 500000,
        currentTrainingFund: 300000,
        currentPortfolio: 200000,
        currentRealEstate: 0,
        currentCrypto: 0,
        currentSavingsAccount: 50000,
        emergencyFund: 150000,
        pensionEmployeeRate: 6,
        pensionEmployerRate: 6.5,
        pensionEmployerBenefitsRate: 6,
        trainingFundEmployeeRate: 2.5,
        trainingFundEmployerRate: 7.5,
        riskTolerance: 'balanced',
        expectedAnnualReturn: 7,
        country: 'israel'
    };
    
    // TEST 1: Function Availability
    console.log('üìã TEST 1: Checking Function Availability...');
    const requiredFunctions = [
        'calculateSavingsRateScore',
        'calculateRetirementReadinessScore',
        'calculateTaxEfficiencyScore',
        'calculateTimeHorizonScore',
        'calculateRiskAlignmentScore',
        'calculateDiversificationScore',
        'calculateEmergencyFundScore',
        'calculateDebtManagementScore'
    ];
    
    requiredFunctions.forEach(func => {
        const exists = typeof window[func] === 'function';
        if (!exists) {
            testResults.functionAvailability.pass = false;
            testResults.functionAvailability.details.push(`‚ùå ${func} NOT FOUND`);
        } else {
            testResults.functionAvailability.details.push(`‚úÖ ${func}`);
        }
    });
    
    // TEST 2: Return Format Check (for problematic functions)
    console.log('\nüìã TEST 2: Checking Return Formats...');
    const problematicFunctions = [
        { name: 'savingsRate', func: 'calculateSavingsRateScore', maxScore: 25 },
        { name: 'retirementReadiness', func: 'calculateRetirementReadinessScore', maxScore: 20 },
        { name: 'taxEfficiency', func: 'calculateTaxEfficiencyScore', maxScore: 8 }
    ];
    
    problematicFunctions.forEach(({ name, func, maxScore }) => {
        if (window[func]) {
            try {
                const result = window[func](testData);
                const hasValidFormat = result && 
                                     typeof result === 'object' && 
                                     typeof result.score === 'number' && 
                                     typeof result.details === 'object';
                
                if (!hasValidFormat) {
                    testResults.returnFormat.pass = false;
                    testResults.returnFormat.details.push(`‚ùå ${name}: Invalid format`);
                } else {
                    testResults.returnFormat.details.push(`‚úÖ ${name}: Valid format (score: ${result.score}/${maxScore})`);
                }
                
                // Also check if score > 0
                if (result.score === 0) {
                    testResults.individualFactors.pass = false;
                    testResults.individualFactors.details.push(`‚ùå ${name}: Still returning 0`);
                } else {
                    testResults.individualFactors.details.push(`‚úÖ ${name}: ${result.score}/${maxScore}`);
                }
            } catch (error) {
                testResults.returnFormat.pass = false;
                testResults.returnFormat.details.push(`‚ùå ${name}: Error - ${error.message}`);
            }
        }
    });
    
    // TEST 3: Full Calculation
    console.log('\nüìã TEST 3: Running Full Score Calculation...');
    if (window.calculateFinancialHealthScore) {
        try {
            const result = window.calculateFinancialHealthScore(testData, {
                combinePartners: false,
                debugMode: true
            });
            
            testResults.fullCalculation.score = result.totalScore;
            
            // Check score range
            if (result.totalScore >= 27 && result.totalScore <= 29) {
                testResults.fullCalculation.pass = false;
                testResults.fullCalculation.details.push('‚ùå CRITICAL: Score is 27-29 (bug still present)');
            } else if (result.totalScore >= 70 && result.totalScore <= 90) {
                testResults.fullCalculation.details.push('‚úÖ Score in expected range (70-90)');
            } else if (result.totalScore >= 40 && result.totalScore <= 69) {
                testResults.fullCalculation.details.push('‚ö†Ô∏è Score improved but below expected (40-69)');
            } else {
                testResults.fullCalculation.details.push(`‚ö†Ô∏è Score outside all ranges: ${result.totalScore}`);
            }
            
            // Add factor breakdown
            if (result.factorScores) {
                const factorDetails = Object.entries(result.factorScores)
                    .map(([factor, data]) => `${factor}: ${data.score || 0}/${data.maxScore || data.weight || '?'}`)
                    .join(', ');
                testResults.fullCalculation.details.push(`Factors: ${factorDetails}`);
            }
        } catch (error) {
            testResults.fullCalculation.pass = false;
            testResults.fullCalculation.details.push(`‚ùå Calculation error: ${error.message}`);
        }
    } else {
        testResults.fullCalculation.pass = false;
        testResults.fullCalculation.details.push('‚ùå calculateFinancialHealthScore not found');
    }
    
    // FINAL RESULTS
    console.log('\n' + '='.repeat(60));
    console.log('üìä FINAL TEST RESULTS');
    console.log('='.repeat(60));
    
    const allTestsPassed = Object.values(testResults).every(test => test.pass);
    
    // Show individual test results
    console.log('\n1Ô∏è‚É£ Function Availability:', testResults.functionAvailability.pass ? '‚úÖ PASS' : '‚ùå FAIL');
    if (!testResults.functionAvailability.pass) {
        testResults.functionAvailability.details.forEach(d => console.log('   ' + d));
    }
    
    console.log('\n2Ô∏è‚É£ Return Format Check:', testResults.returnFormat.pass ? '‚úÖ PASS' : '‚ùå FAIL');
    if (!testResults.returnFormat.pass) {
        testResults.returnFormat.details.forEach(d => console.log('   ' + d));
    }
    
    console.log('\n3Ô∏è‚É£ Individual Factors:', testResults.individualFactors.pass ? '‚úÖ PASS' : '‚ùå FAIL');
    testResults.individualFactors.details.forEach(d => console.log('   ' + d));
    
    console.log('\n4Ô∏è‚É£ Full Calculation:', testResults.fullCalculation.pass ? '‚úÖ PASS' : '‚ùå FAIL');
    console.log('   Score:', testResults.fullCalculation.score);
    testResults.fullCalculation.details.forEach(d => console.log('   ' + d));
    
    // FINAL VERDICT
    console.log('\n' + '='.repeat(60));
    if (allTestsPassed && testResults.fullCalculation.score >= 70) {
        console.log('üéâ SUCCESS: v7.4.1 FIX IS WORKING PERFECTLY!');
        console.log('‚úÖ All calculator functions are accessible');
        console.log('‚úÖ All return correct format');
        console.log('‚úÖ No factors returning 0');
        console.log(`‚úÖ Score is ${testResults.fullCalculation.score} (expected: 70-90)`);
        console.log('‚úÖ The 27-29 bug is FIXED!');
    } else if (testResults.fullCalculation.score >= 40 && testResults.fullCalculation.score < 70) {
        console.log('‚ö†Ô∏è PARTIAL SUCCESS: v7.4.1 fix is deployed but score is lower than expected');
        console.log(`üìä Score: ${testResults.fullCalculation.score} (expected: 70-90)`);
        console.log('Some factors may need additional attention');
    } else {
        console.log('‚ùå FAILURE: v7.4.1 fix is not working properly');
        console.log('Please check:');
        console.log('1. Clear cache (Ctrl+F5)');
        console.log('2. Verify you are on v7.4.1');
        console.log('3. Check which tests failed above');
    }
    console.log('='.repeat(60));
    
    // Return summary for easy reference
    return {
        passed: allTestsPassed,
        score: testResults.fullCalculation.score,
        version: window.APP_VERSION || 'unknown',
        timestamp: new Date().toISOString()
    };
})();
            <button class="copy-btn">Copy</button>
        </div>
    </div>

    <div class="container">
        <h2>What You'll See</h2>
        <p>After running the command, you'll see:</p>
        <ul>
            <li>‚úÖ or ‚ùå for each test category</li>
            <li>The actual financial health score</li>
            <li>A clear verdict: SUCCESS, PARTIAL SUCCESS, or FAILURE</li>
            <li>Specific details about what's working or broken</li>
        </ul>
        
        <p><strong>Expected Result:</strong> You should see "üéâ SUCCESS" with a score between 70-90.</p>
    </div>

    <script>
        function copyToClipboard(element) {
            const codeBlock = element.cloneNode(true);
            const button = codeBlock.querySelector('.copy-btn');
            if (button) button.remove();
            
            const text = codeBlock.textContent.trim();
            
            navigator.clipboard.writeText(text).then(() => {
                const btn = element.querySelector('.copy-btn');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.style.background = '#28a745';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#28a745';
                }, 2000);
            }).catch(err => {
                alert('Failed to copy. Please select and copy manually.');
            });
        }
    </script>
</body>
</html>