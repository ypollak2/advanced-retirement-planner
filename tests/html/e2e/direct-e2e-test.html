<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct E2E Test - Financial Health Score</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        .test-case {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .pass {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        .fail {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-family: monospace;
        }
        .critical {
            color: #dc3545;
            font-weight: bold;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-section">
        <h1>üß™ Direct E2E Test - Financial Health Score</h1>
        <p>This page will directly test the financial health scoring without iframes.</p>
        <p><strong>Production URL:</strong> <a href="https://ypollak2.github.io/advanced-retirement-planner/" target="_blank">https://ypollak2.github.io/advanced-retirement-planner/</a></p>
        <p><strong>Expected Version:</strong> v7.4.0</p>
    </div>

    <div class="test-section">
        <h2>Quick Test Scenarios</h2>
        <button onclick="testHighIncome()">Test High Income Scenario</button>
        <button onclick="testLowIncome()">Test Low Income Scenario</button>
        <button onclick="testCoupleMode()">Test Couple Mode</button>
        <button onclick="testEdgeCase()">Test Edge Case</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>

    <div id="results" class="test-section" style="display: none;">
        <h2>Test Results</h2>
        <div id="resultsContent"></div>
    </div>

    <script>
        const PRODUCTION_URL = 'https://ypollak2.github.io/advanced-retirement-planner/';

        function showResult(title, data, expected, actual, passed) {
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('resultsContent');
            
            resultsDiv.style.display = 'block';
            
            const resultHtml = `
                <div class="test-case ${passed ? 'pass' : 'fail'}">
                    <h3>${title}</h3>
                    <div class="result">
                        <strong>Test Data:</strong>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                    <div class="result">
                        <strong>Expected Score Range:</strong> ${expected.min} - ${expected.max}
                    </div>
                    <div class="result">
                        <strong>Actual Score:</strong> <span class="${passed ? 'success' : 'critical'}">${actual}</span>
                    </div>
                    <div class="result">
                        <strong>Status:</strong> ${passed ? '‚úÖ PASSED' : '‚ùå FAILED'}
                        ${actual >= 27 && actual <= 29 ? '<br><span class="critical">‚ö†Ô∏è CRITICAL BUG: Score in 27-29 range!</span>' : ''}
                    </div>
                </div>
            `;
            
            contentDiv.innerHTML += resultHtml;
        }

        async function runTest(testName, testData, expectedRange) {
            try {
                // Open production app in new window
                const testWindow = window.open(PRODUCTION_URL, '_blank');
                
                alert(`Test "${testName}" is ready to run.
                
1. The app has opened in a new window/tab
2. Copy the test data from this page
3. Enter it manually in the app
4. Calculate the financial health score
5. Return here and enter the score you received`);
                
                const actualScore = prompt('Enter the financial health score you received:');
                
                if (actualScore) {
                    const score = parseFloat(actualScore);
                    const passed = score >= expectedRange.min && score <= expectedRange.max;
                    showResult(testName, testData, expectedRange, score, passed);
                }
                
            } catch (error) {
                alert('Error running test: ' + error.message);
            }
        }

        function testHighIncome() {
            const data = {
                planningType: 'individual',
                currentAge: 35,
                retirementAge: 67,
                currentMonthlySalary: 50000,
                currentMonthlyExpenses: 25000,
                currentPension: 500000,
                currentTrainingFund: 300000,
                emergencyFund: 150000,
                pensionContributionRate: 18.5,
                trainingFundContributionRate: 10,
                riskTolerance: 'balanced',
                expectedAnnualReturn: 7
            };
            
            runTest('High Income Individual', data, { min: 70, max: 95 });
        }

        function testLowIncome() {
            const data = {
                planningType: 'individual',
                currentAge: 28,
                retirementAge: 67,
                currentMonthlySalary: 8000,
                currentMonthlyExpenses: 7500,
                currentPension: 10000,
                currentTrainingFund: 5000,
                emergencyFund: 0,
                pensionContributionRate: 6,
                trainingFundContributionRate: 2.5,
                riskTolerance: 'conservative',
                expectedAnnualReturn: 4
            };
            
            runTest('Low Income Individual', data, { min: 15, max: 40 });
        }

        function testCoupleMode() {
            const data = {
                planningType: 'couple',
                partner1Name: 'Partner 1',
                partner1Age: 40,
                partner1Salary: 25000,
                partner1Pension: 200000,
                partner1TrainingFund: 100000,
                partner2Name: 'Partner 2',
                partner2Age: 38,
                partner2Salary: 20000,
                partner2Pension: 150000,
                partner2TrainingFund: 80000,
                retirementAge: 67,
                currentMonthlyExpenses: 30000,
                emergencyFund: 100000,
                riskTolerance: 'moderate',
                expectedAnnualReturn: 6
            };
            
            runTest('Couple Mode', data, { min: 55, max: 80 });
        }

        function testEdgeCase() {
            const data = {
                planningType: 'individual',
                currentAge: 25,
                retirementAge: 67,
                currentMonthlySalary: 0,
                currentMonthlyExpenses: 5000,
                currentPension: 0,
                currentTrainingFund: 0,
                emergencyFund: 0,
                pensionContributionRate: 0,
                trainingFundContributionRate: 0,
                riskTolerance: 'conservative',
                expectedAnnualReturn: 3
            };
            
            runTest('Zero Income Edge Case', data, { min: 0, max: 15 });
        }

        function clearResults() {
            document.getElementById('resultsContent').innerHTML = '';
            document.getElementById('results').style.display = 'none';
        }
    </script>

    <div class="test-section">
        <h2>üìã Manual Test Instructions</h2>
        <ol>
            <li>Click one of the test buttons above</li>
            <li>A new window will open with the production app</li>
            <li>Copy the test data shown here</li>
            <li>Enter it into the app manually</li>
            <li>Navigate to the financial health score calculation</li>
            <li>Note the score and return here to enter it</li>
            <li>The test will show if it passed or failed</li>
        </ol>
        
        <h3>‚ö†Ô∏è Known Issues to Check:</h3>
        <ul>
            <li><strong>Critical Low Score Bug:</strong> Scores of 27-29 regardless of input</li>
            <li><strong>Field Mapping:</strong> Data not flowing correctly through wizard</li>
            <li><strong>Couple Mode:</strong> Partner data not combining properly</li>
            <li><strong>Zero Scores:</strong> Many factors returning 0 unexpectedly</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üîó Direct Links</h2>
        <p><a href="https://ypollak2.github.io/advanced-retirement-planner/tests/e2e/financial-health-e2e-suite.html" target="_blank">Full E2E Test Suite</a></p>
        <p><a href="https://ypollak2.github.io/advanced-retirement-planner/tests/e2e/financial-health-e2e-suite.html?autorun=true" target="_blank">Auto-run E2E Tests</a></p>
    </div>
</body>
</html>