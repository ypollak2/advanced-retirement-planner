<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Browser Test Fixes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold mb-4">Browser Test Fix Verification</h1>
        <div id="results" class="space-y-4"></div>
    </div>

    <!-- Load all dependencies in correct order -->
    <script src="src/data/marketConstants.js"></script>
    <script src="src/translations/multiLanguage.js"></script>
    <script src="src/utils/retirementCalculations.js"></script>
    <script src="src/utils/currencyAPI.js"></script>
    <script src="src/utils/financialHealthEngine.js"></script>
    <script src="src/utils/financialHealthValidation.js"></script>
    <script src="src/utils/financialHealthMessages.js"></script>
    <script src="src/utils/coupleValidation.js"></script>
    <script src="src/utils/performanceOptimizer.js"></script>
    <script src="src/utils/exportFunctions.js"></script>
    <script src="src/utils/performanceMonitor.js"></script>
    <script src="src/components/shared/EnhancedRSUCompanySelector.js"></script>
    <script src="src/components/shared/PartnerRSUSelector.js"></script>
    <script src="src/components/core/RetirementPlannerApp.js"></script>
    
    <script>
        // Provide risk scenarios fallback
        window.riskScenarios = window.riskScenarios || {
            conservative: { returnRate: 5, name: 'Conservative' },
            moderate: { returnRate: 7, name: 'Moderate' },
            aggressive: { returnRate: 10, name: 'Aggressive' }
        };
    </script>

    <script>
        // Quick verification script
        async function runVerificationTests() {
            const results = document.getElementById('results');
            const tests = [];
            
            // Test 1: Check all required globals
            tests.push({
                name: 'Required Globals',
                test: () => {
                    const required = [
                        'multiLanguage',
                        'RetirementPlannerApp',
                        'performanceMonitor',
                        'exportFunctions',
                        'coupleValidation',
                        'riskScenarios',
                        'EnhancedRSUCompanySelector',
                        'PartnerRSUSelector',
                        'formatCurrency',
                        'calculateFinancialHealthScore'
                    ];
                    const missing = required.filter(name => !window[name]);
                    if (missing.length === 0) {
                        return { passed: true, message: 'All required globals loaded' };
                    }
                    return { passed: false, message: `Missing: ${missing.join(', ')}` };
                }
            });
            
            // Test 2: Currency API rates
            tests.push({
                name: 'Currency API Rates',
                test: async () => {
                    try {
                        const rate = await currencyAPI.getRate('USD', 'ILS');
                        if (rate > 3 && rate < 4.5) {
                            return { passed: true, message: `USD to ILS rate: ${rate.toFixed(2)}` };
                        }
                        return { passed: false, message: `Invalid USD rate: ${rate}` };
                    } catch (e) {
                        return { passed: false, message: e.message };
                    }
                }
            });
            
            // Test 3: Performance optimizer recursion
            tests.push({
                name: 'Performance Optimizer',
                test: () => {
                    try {
                        const result = calculateFinancialHealthScore({
                            currentAge: 30,
                            retirementAge: 65,
                            currentMonthlySalary: 10000
                        });
                        return { passed: true, message: `Score calculated: ${result.totalScore}` };
                    } catch (e) {
                        return { passed: false, message: e.message };
                    }
                }
            });
            
            // Test 4: React components
            tests.push({
                name: 'React Components',
                test: () => {
                    try {
                        const testDiv = document.createElement('div');
                        document.body.appendChild(testDiv);
                        
                        // Test RSU selector
                        const rsuElement = React.createElement(EnhancedRSUCompanySelector, {
                            onChange: () => {},
                            currency: 'USD'
                        });
                        ReactDOM.render(rsuElement, testDiv);
                        
                        document.body.removeChild(testDiv);
                        return { passed: true, message: 'Components render without errors' };
                    } catch (e) {
                        return { passed: false, message: e.message };
                    }
                }
            });
            
            // Test 5: Format currency
            tests.push({
                name: 'Format Currency',
                test: () => {
                    try {
                        const formatted = formatCurrency(1234567.89);
                        if (formatted.includes('‚Ç™')) {
                            return { passed: true, message: `Formatted: ${formatted}` };
                        }
                        return { passed: false, message: `Invalid format: ${formatted}` };
                    } catch (e) {
                        return { passed: false, message: e.message };
                    }
                }
            });
            
            // Run all tests
            let passed = 0;
            for (const test of tests) {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'p-4 rounded-lg';
                
                try {
                    const result = await test.test();
                    if (result.passed) {
                        passed++;
                        resultDiv.className += ' bg-green-100 border-l-4 border-green-500';
                        resultDiv.innerHTML = `
                            <h3 class="font-semibold text-green-800">‚úÖ ${test.name}</h3>
                            <p class="text-sm text-green-700">${result.message}</p>
                        `;
                    } else {
                        resultDiv.className += ' bg-red-100 border-l-4 border-red-500';
                        resultDiv.innerHTML = `
                            <h3 class="font-semibold text-red-800">‚ùå ${test.name}</h3>
                            <p class="text-sm text-red-700">${result.message}</p>
                        `;
                    }
                } catch (e) {
                    resultDiv.className += ' bg-red-100 border-l-4 border-red-500';
                    resultDiv.innerHTML = `
                        <h3 class="font-semibold text-red-800">‚ùå ${test.name}</h3>
                        <p class="text-sm text-red-700">Error: ${e.message}</p>
                    `;
                }
                
                results.appendChild(resultDiv);
            }
            
            // Summary
            const summary = document.createElement('div');
            summary.className = 'mt-6 p-4 rounded-lg ' + (passed === tests.length ? 'bg-green-100' : 'bg-yellow-100');
            summary.innerHTML = `
                <h2 class="text-xl font-bold">${passed === tests.length ? 'üéâ' : '‚ö†Ô∏è'} Test Summary</h2>
                <p class="text-lg">${passed}/${tests.length} tests passed (${Math.round(passed/tests.length*100)}%)</p>
            `;
            results.appendChild(summary);
        }
        
        // Run tests after page loads
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(runVerificationTests, 1000);
        });
    </script>
</body>
</html>