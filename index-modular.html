<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Retirement Planner - Professional Pension Planning Tool</title>
    <meta name="description" content="Advanced retirement planning tool with index returns, risk levels, and accurate tax calculations">
    <meta name="keywords" content="retirement, pension planning, retirement calculator, pension savings, training fund, investment planning">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .currency-format {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
        }
        
        /* RTL support */
        [dir="rtl"] .ml-2 { margin-left: 0; margin-right: 0.5rem; }
        [dir="rtl"] .mr-2 { margin-right: 0; margin-left: 0.5rem; }
        [dir="ltr"] .ml-2 { margin-left: 0.5rem; margin-right: 0; }
        [dir="ltr"] .mr-2 { margin-right: 0.5rem; margin-left: 0; }
    </style>
</head>
<body>
    <div id="root" class="min-h-screen gradient-bg"></div>
    
    <script type="module">
        // Import modules
        import { translations } from './src/translations/multiLanguage.js';
        import { exchangeRates, countryData, historicalReturns, indexNames, riskScenarios } from './src/data/marketConstants.js';
        import { formatCurrency, convertCurrency, calculateRetirement } from './src/utils/retirementCalculations.js';
        import { generateChartData } from './src/utils/chartDataGenerator.js';
        import { SimpleChart } from './src/components/FinancialChart.js';

        // Loading indicator
        document.getElementById('root').innerHTML = `
            <div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center">
                <div class="text-center">
                    <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto mb-4"></div>
                    <p class="text-gray-600 text-lg">Loading Advanced Retirement Planner...</p>
                    <p class="text-gray-500 text-sm mt-2">Initializing modular components...</p>
                </div>
            </div>
        `;

        // Initialize app
        const { useState, useEffect } = React;

        // Icon components
        const Calculator = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'ðŸ“Š');
        
        const TrendingUp = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'ðŸ“ˆ');
        
        const Settings = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'âš™ï¸');
        
        const BarChart3 = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'ðŸ“Š');
        
        const Target = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'ðŸŽ¯');
        
        const Languages = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'ðŸŒ');

        const DollarSign = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'ðŸ’°');

        const Building = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'ðŸ¢');

        // Main App Component
        const RetirementPlanner = () => {
            const [language, setLanguage] = useState('he');
            const [activeTab, setActiveTab] = useState('basic');
            const [results, setResults] = useState(null);
            const [chartData, setChartData] = useState([]);
            const [showChart, setShowChart] = useState(false);

            // Initial state with all investment types
            const [inputs, setInputs] = useState({
                currentAge: 30,
                retirementAge: 67,
                currentSavings: 50000,
                inflationRate: 3,
                currentMonthlyExpenses: 12000,
                targetReplacement: 75,
                riskTolerance: 'moderate',
                currentTrainingFund: 25000,
                trainingFundReturn: 6.5,
                trainingFundManagementFee: 0.5,
                // Personal investment portfolio (no tax benefits)
                currentPersonalPortfolio: 0,
                personalPortfolioMonthly: 0,
                personalPortfolioReturn: 8.0,
                personalPortfolioTaxRate: 25,
                // Cryptocurrency portfolio
                currentCrypto: 0,
                cryptoMonthly: 0,
                cryptoReturn: 15.0,
                cryptoTaxRate: 25,
                // FIRE calculation
                fireTargetAge: 50,
                fireMonthlyExpenses: 15000,
                fireSafeWithdrawlRate: 4.0,
                // Real Estate Investment
                currentRealEstate: 0,
                realEstateMonthly: 0,
                realEstateReturn: 6.0,
                realEstateRentalYield: 4.0,
                realEstateTaxRate: 10
            });

            const [workPeriods, setWorkPeriods] = useState([
                {
                    id: 1,
                    country: 'israel',
                    startAge: 30,
                    endAge: 67,
                    monthlyContribution: 2000,
                    salary: 15000,
                    pensionReturn: 7.0,
                    pensionDepositFee: 0.5,
                    pensionAnnualFee: 1.0,
                    monthlyTrainingFund: 500
                }
            ]);

            const [pensionIndexAllocation, setPensionIndexAllocation] = useState([
                { index: 'S&P 500', percentage: 60, customReturn: null },
                { index: 'Government Bonds', percentage: 40, customReturn: null }
            ]);

            const [trainingFundIndexAllocation, setTrainingFundIndexAllocation] = useState([
                { index: 'Tel Aviv 35', percentage: 100, customReturn: null }
            ]);

            const t = translations[language];

            // Auto calculation when inputs change
            useEffect(() => {
                const calculationResult = calculateRetirement(
                    inputs, 
                    workPeriods, 
                    pensionIndexAllocation, 
                    trainingFundIndexAllocation,
                    historicalReturns
                );
                setResults(calculationResult);
            }, [inputs, workPeriods, pensionIndexAllocation, trainingFundIndexAllocation]);

            // Generate chart data when needed
            useEffect(() => {
                if (showChart) {
                    const chartPoints = generateChartData(
                        inputs, 
                        workPeriods, 
                        pensionIndexAllocation, 
                        trainingFundIndexAllocation,
                        historicalReturns
                    );
                    setChartData(chartPoints);
                }
            }, [inputs, workPeriods, showChart, pensionIndexAllocation, trainingFundIndexAllocation]);

            return React.createElement('div', {
                className: `min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-4 ${language === 'he' ? 'dir-rtl' : 'dir-ltr'}`,
                dir: language === 'he' ? 'rtl' : 'ltr'
            }, [
                React.createElement('div', { className: "max-w-7xl mx-auto" }, [
                    // Header
                    React.createElement('div', { className: "text-center mb-8 animate-fade-in" }, [
                        React.createElement('div', { className: "flex justify-center items-center gap-4 mb-4" }, [
                            React.createElement('div', { className: "flex items-center gap-3" }, [
                                React.createElement('div', { 
                                    className: "w-16 h-16 bg-gradient-to-br from-purple-600 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg transform rotate-3 hover:rotate-0 transition-transform duration-300"
                                }, [
                                    React.createElement('span', { 
                                        className: "text-2xl text-white font-bold" 
                                    }, "ðŸ’°")
                                ]),
                                React.createElement('h1', { 
                                    className: "text-4xl font-bold bg-gradient-to-r from-purple-800 to-blue-800 bg-clip-text text-transparent"
                                }, t.title)
                            ]),
                            React.createElement('button', {
                                onClick: () => setLanguage(language === 'he' ? 'en' : 'he'),
                                className: "bg-gradient-to-r from-purple-500 to-blue-500 text-white px-4 py-2 rounded-lg flex items-center hover:from-purple-600 hover:to-blue-600 transition-all duration-300 shadow-lg"
                            }, [
                                React.createElement(Languages, { size: 20, className: "mr-2" }),
                                language === 'he' ? 'English' : '×¢×‘×¨×™×ª'
                            ])
                        ]),
                        React.createElement('p', { 
                            className: "text-lg text-gray-600 mb-6" 
                        }, t.subtitle),
                        
                        // Tabs
                        React.createElement('div', { className: "flex justify-center space-x-1 bg-white rounded-xl p-1 shadow-lg max-w-3xl mx-auto" }, [
                            { id: 'basic', icon: Calculator, label: t.basic },
                            { id: 'advanced', icon: Settings, label: t.advanced },
                            { id: 'analysis', icon: BarChart3, label: t.analysis },
                            { id: 'scenarios', icon: Target, label: t.scenarios },
                            { id: 'fire', icon: TrendingUp, label: t.fireCalculator }
                        ].map(tab => 
                            React.createElement('button', {
                                key: tab.id,
                                onClick: () => setActiveTab(tab.id),
                                className: `flex items-center px-6 py-3 rounded-lg transition-all duration-300 ${
                                    activeTab === tab.id
                                        ? 'bg-gradient-to-r from-purple-500 to-blue-500 text-white shadow-lg transform scale-105'
                                        : 'text-gray-600 hover:text-purple-700 hover:bg-purple-50'
                                }`
                            }, [
                                React.createElement(tab.icon, { size: 16, className: "mr-2" }),
                                tab.label
                            ])
                        ))
                    ]),

                    // Content tabs
                    React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-3 gap-8" }, [
                        // Left Column - Input Forms
                        React.createElement('div', { className: "lg:col-span-2 space-y-6" }, [
                            // Basic Tab with new investment types
                            activeTab === 'basic' && React.createElement('div', { className: "space-y-6" }, [
                                // Personal Portfolio Section
                                React.createElement('div', { className: "glass-effect rounded-2xl shadow-xl p-6 border border-white/20 animate-fade-in" }, [
                                    React.createElement('h2', { className: "text-2xl font-bold text-purple-700 mb-6 flex items-center" }, [
                                        React.createElement(DollarSign, { className: "mr-2" }),
                                        language === 'he' ? "×ª×™×§ ×”×©×§×¢×•×ª ××™×©×™" : "Personal Investment Portfolio"
                                    ]),
                                    React.createElement('div', { className: "bg-purple-50 rounded-lg p-4 mb-6 border border-purple-200" }, [
                                        React.createElement('p', { className: "text-sm text-purple-700 mb-2" }, [
                                            React.createElement('strong', null, 
                                                language === 'he' ? "×—×©×•×‘ ×œ×“×¢×ª:" : "Important to Know:"),
                                            React.createElement('span', { className: "block mt-1" }, 
                                                language === 'he' ? "×”×©×§×¢×•×ª ××™×©×™×•×ª ××™× ×Ÿ ×–×•×›×•×ª ×œ×”×˜×‘×•×ª ×ž×¡ ×›×ž×• ×¤× ×¡×™×” ×•×§×¨×Ÿ ×”×©×ª×œ×ž×•×ª" : "Personal investments don't receive tax benefits like pension and training funds")
                                        ])
                                    ]),
                                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6" }, [
                                        React.createElement('div', null, [
                                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, 
                                                language === 'he' ? "×¦×‘×™×¨×” × ×•×›×—×™×ª (â‚ª)" : "Current Accumulation (â‚ª)"),
                                            React.createElement('input', {
                                                type: 'number',
                                                value: inputs.currentPersonalPortfolio,
                                                onChange: (e) => setInputs({...inputs, currentPersonalPortfolio: parseInt(e.target.value) || 0}),
                                                className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                            })
                                        ]),
                                        React.createElement('div', null, [
                                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, 
                                                language === 'he' ? "×”×©×§×¢×” ×—×•×“×©×™×ª (â‚ª)" : "Monthly Investment (â‚ª)"),
                                            React.createElement('input', {
                                                type: 'number',
                                                value: inputs.personalPortfolioMonthly,
                                                onChange: (e) => setInputs({...inputs, personalPortfolioMonthly: parseInt(e.target.value) || 0}),
                                                className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                            })
                                        ])
                                    ])
                                ]),

                                // Real Estate Section  
                                React.createElement('div', { className: "glass-effect rounded-2xl shadow-xl p-6 border border-white/20 animate-fade-in" }, [
                                    React.createElement('h2', { className: "text-2xl font-bold text-emerald-700 mb-6 flex items-center" }, [
                                        React.createElement(Building, { className: "mr-2" }),
                                        language === 'he' ? "×”×©×§×¢×•×ª × ×“×œ\"×Ÿ" : "Real Estate Investment"
                                    ]),
                                    React.createElement('div', { className: "bg-emerald-50 rounded-lg p-4 mb-6 border border-emerald-200" }, [
                                        React.createElement('p', { className: "text-sm text-emerald-700 mb-2" }, [
                                            React.createElement('strong', null, 
                                                language === 'he' ? "×›×•×œ×œ:" : "Includes:"),
                                            React.createElement('span', { className: "block mt-1" }, 
                                                language === 'he' ? "×¢×œ×™×™×ª ×¢×¨×š ×”× ×›×¡ ×•×“×ž×™ ×©×›×™×¨×•×ª ×—×•×“×©×™×™×" : "Property appreciation and monthly rental income")
                                        ])
                                    ]),
                                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6" }, [
                                        React.createElement('div', null, [
                                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, 
                                                language === 'he' ? "×”×©×§×¢×” × ×•×›×—×™×ª (â‚ª)" : "Current Investment (â‚ª)"),
                                            React.createElement('input', {
                                                type: 'number',
                                                value: inputs.currentRealEstate,
                                                onChange: (e) => setInputs({...inputs, currentRealEstate: parseInt(e.target.value) || 0}),
                                                className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                            })
                                        ]),
                                        React.createElement('div', null, [
                                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, 
                                                language === 'he' ? "×”×©×§×¢×” ×—×•×“×©×™×ª (â‚ª)" : "Monthly Investment (â‚ª)"),
                                            React.createElement('input', {
                                                type: 'number',
                                                value: inputs.realEstateMonthly,
                                                onChange: (e) => setInputs({...inputs, realEstateMonthly: parseInt(e.target.value) || 0}),
                                                className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
                                            })
                                        ])
                                    ])
                                ])
                            ])
                        ]),

                        // Right Column - Results
                        results && React.createElement('div', { className: "space-y-6" }, [
                            React.createElement('div', { className: "glass-effect rounded-2xl shadow-xl p-6 border border-white/20 animate-fade-in" }, [
                                React.createElement('h2', { className: "text-2xl font-bold text-green-700 mb-6" }, t.results),
                                React.createElement('div', { className: "space-y-4" }, [
                                    React.createElement('div', { className: "text-center p-4 bg-gradient-to-r from-green-100 to-blue-100 rounded-xl" }, [
                                        React.createElement('div', { className: "text-3xl font-bold text-green-700 currency-format" }, 
                                            formatCurrency(results.totalSavings + results.trainingFundValue + results.personalPortfolioValue + results.cryptoValue + results.realEstateValue)),
                                        React.createElement('div', { className: "text-sm text-gray-600" }, 
                                            language === 'he' ? "×¡×”\"×› ×¦×‘×™×¨×” ×¦×¤×•×™×”" : "Total Expected Accumulation")
                                    ]),
                                    React.createElement('div', { className: "text-center p-4 bg-gradient-to-r from-blue-100 to-purple-100 rounded-xl" }, [
                                        React.createElement('div', { className: "text-2xl font-bold text-blue-700 currency-format" }, 
                                            formatCurrency(results.totalNetIncome)),
                                        React.createElement('div', { className: "text-sm text-gray-600" }, 
                                            language === 'he' ? "×”×›× ×¡×” ×—×•×“×©×™×ª × ×˜×•" : "Net Monthly Income")
                                    ])
                                ])
                            ])
                        ])
                    ]),

                    // Chart Section
                    results && showChart && chartData && chartData.length > 1 && React.createElement('div', { 
                        className: "mt-8 glass-effect rounded-2xl shadow-xl p-6 border border-white/20 animate-fade-in" 
                    }, [
                        React.createElement('h3', { className: "text-2xl font-bold text-purple-700 mb-6 flex items-center" }, [
                            React.createElement(TrendingUp, { className: "mr-2" }),
                            t.progressChart
                        ]),
                        React.createElement('div', { className: "h-96 mb-4" },
                            React.createElement(SimpleChart, { 
                                data: chartData,
                                type: 'line',
                                language: language
                            })
                        ),
                        React.createElement('div', { className: "flex justify-center" }, [
                            React.createElement('button', {
                                onClick: () => setShowChart(false),
                                className: "px-6 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors"
                            }, language === 'he' ? "×”×¡×ª×¨ ×’×¨×£" : "Hide Chart")
                        ])
                    ]),

                    // Show Chart Button
                    results && !showChart && React.createElement('div', { className: "mt-8 text-center" }, [
                        React.createElement('button', {
                            onClick: () => setShowChart(true),
                            className: "px-8 py-3 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-lg hover:from-purple-600 hover:to-blue-600 transition-all duration-300 shadow-lg flex items-center mx-auto"
                        }, [
                            React.createElement(TrendingUp, { size: 20, className: "mr-2" }),
                            language === 'he' ? "×”×¦×’ ×’×¨×£ ×”×ª×§×“×ž×•×ª" : "Show Progress Chart"
                        ])
                    ])
                ])
            ]);
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(RetirementPlanner));
    </script>
</body>
</html>