<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Retirement Planner - Professional Pension Planning Tool</title>
    <meta name="description" content="Advanced retirement planning tool with comprehensive investment tracking, FIRE calculator, partner planning, and stress testing">
    <meta name="keywords" content="retirement, pension planning, retirement calculator, pension savings, training fund, investment planning, partner planning, family financial planning">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .currency-format {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
        }
        
        /* RTL support */
        [dir="rtl"] .ml-2 { margin-left: 0; margin-right: 0.5rem; }
        [dir="rtl"] .mr-2 { margin-right: 0; margin-left: 0.5rem; }
        [dir="ltr"] .ml-2 { margin-left: 0.5rem; margin-right: 0; }
        [dir="ltr"] .mr-2 { margin-right: 0.5rem; margin-left: 0; }
    </style>
</head>
<body>
    <div id="root" class="min-h-screen gradient-bg"></div>
    
    <!-- Load modules as scripts instead of ES6 imports for GitHub Pages compatibility -->
    <script src="./src/translations/multiLanguage.js"></script>
    <script src="./src/data/marketConstants.js"></script>
    <script src="./src/utils/retirementCalculations.js"></script>
    <script src="./src/utils/chartDataGenerator.js"></script>
    <script src="./src/components/FinancialChart.js"></script>
    <script src="./src/utils/analyticsTracker.js"></script>
    <script src="./src/utils/stressTestLogic.js"></script>
    <!-- Load main component files -->
    <script src="./src/components/RetirementPlannerApp.js"></script>
    <script src="./src/components/RetirementBasicForm.js"></script>
    <script src="./src/components/RetirementAdvancedForm.js"></script>
    <script src="./src/components/RetirementResultsPanel.js"></script>
    
    <script>
        // React components and hooks
        const { useState, useEffect, createElement } = React;

        // Loading indicator
        const LoadingSpinner = ({ size = 32, color = "text-purple-600" }) => {
            return createElement('div', { 
                className: `${color} text-center py-8`
            }, createElement('div', {
                className: `inline-block animate-spin rounded-full border-4 border-solid border-current border-r-transparent`,
                style: { width: `${size}px`, height: `${size}px` }
            }));
        };

        // Error boundary component
        const ErrorBoundary = ({ children }) => {
            const [hasError, setHasError] = useState(false);
            const [error, setError] = useState(null);

            useEffect(() => {
                const handleError = (event) => {
                    console.error('Application error:', event.error);
                    setError(event.error);
                    setHasError(true);
                };

                window.addEventListener('error', handleError);
                window.addEventListener('unhandledrejection', handleError);

                return () => {
                    window.removeEventListener('error', handleError);
                    window.removeEventListener('unhandledrejection', handleError);
                };
            }, []);

            if (hasError) {
                return createElement('div', {
                    className: 'flex items-center justify-center min-h-screen p-8'
                }, createElement('div', {
                    className: 'glass-effect rounded-2xl p-8 max-w-md mx-auto text-center'
                }, [
                    createElement('h2', {
                        key: 'title',
                        className: 'text-2xl font-bold text-red-600 mb-4'
                    }, 'âš ï¸ Application Error'),
                    createElement('p', {
                        key: 'message',
                        className: 'text-gray-700 mb-4'
                    }, 'The application encountered an error. Please refresh the page to try again.'),
                    createElement('button', {
                        key: 'refresh',
                        className: 'px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors',
                        onClick: () => window.location.reload()
                    }, 'Refresh Page')
                ]));
            }

            return children;
        };

        // Main App Component using external modules
        const App = () => {
            const [isLoaded, setIsLoaded] = useState(false);
            const [loadError, setLoadError] = useState(null);

            useEffect(() => {
                let attempts = 0;
                const maxAttempts = 100; // 10 seconds maximum
                
                // Check if all required modules are loaded
                const checkModules = () => {
                    attempts++;
                    try {
                        // Check if all required functions and components are available
                        const required = [
                            'RetirementPlannerApp',
                            'BasicInputs', 
                            'AdvancedInputs',
                            'ResultsPanel',
                            'calculateRetirement',
                            'multiLanguage',
                            'countryData',
                            'formatCurrency'
                        ];

                        const missing = required.filter(name => !window[name]);
                        
                        console.log(`Attempt ${attempts}/${maxAttempts}:`);
                        console.log('Required modules:', required);
                        console.log('Missing modules:', missing);
                        console.log('Available modules:', required.filter(name => window[name]));
                        
                        if (missing.length === 0) {
                            console.log('All modules loaded successfully!');
                            setIsLoaded(true);
                        } else {
                            if (attempts >= maxAttempts) {
                                console.error('Module loading timeout after 10 seconds');
                                console.error('Still missing:', missing);
                                setLoadError(new Error('Module loading timeout. Missing modules: ' + missing.join(', ')));
                            } else {
                                setTimeout(checkModules, 100); // Check again in 100ms
                            }
                        }
                    } catch (error) {
                        console.error('Error checking modules:', error);
                        setLoadError(error);
                    }
                };

                // Start checking after a brief delay to allow scripts to load
                setTimeout(checkModules, 200);
            }, []);

            if (loadError) {
                return createElement('div', {
                    className: 'flex items-center justify-center min-h-screen p-8'
                }, createElement('div', {
                    className: 'glass-effect rounded-2xl p-8 max-w-md mx-auto text-center'
                }, [
                    createElement('h2', {
                        key: 'title',
                        className: 'text-2xl font-bold text-red-600 mb-4'
                    }, 'âš ï¸ Loading Error'),
                    createElement('p', {
                        key: 'message',
                        className: 'text-gray-700 mb-4'
                    }, 'Failed to load application modules. Please check your internet connection and refresh the page.'),
                    createElement('button', {
                        key: 'refresh',
                        className: 'px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors',
                        onClick: () => window.location.reload()
                    }, 'Refresh Page')
                ]));
            }

            if (!isLoaded) {
                return createElement('div', {
                    className: 'flex items-center justify-center min-h-screen'
                }, createElement('div', {
                    className: 'glass-effect rounded-2xl p-8 text-center'
                }, [
                    createElement(LoadingSpinner, { key: 'spinner', size: 48 }),
                    createElement('p', {
                        key: 'text',
                        className: 'mt-4 text-purple-700 font-semibold'
                    }, 'Loading Advanced Retirement Planner...')
                ]));
            }

            // Use the external RetirementPlannerApp hook for state management
            const appState = window.RetirementPlannerApp();
            
            // Extract state and functions from the hook
            const {
                language, setLanguage,
                activeTab, setActiveTab,
                results, setResults,
                chartData, setChartData,
                showChart, setShowChart,
                inputs, setInputs,
                workPeriods, setWorkPeriods,
                partnerWorkPeriods, setPartnerWorkPeriods,
                pensionIndexAllocation, setPensionIndexAllocation,
                trainingFundIndexAllocation, setTrainingFundIndexAllocation
            } = appState;

            const t = window.multiLanguage[language];

            return createElement('div', {
                className: 'min-h-screen gradient-bg py-8 px-4',
                dir: language === 'he' ? 'rtl' : 'ltr'
            }, [
                // Header
                createElement('div', {
                    key: 'header',
                    className: 'text-center mb-8'
                }, [
                    createElement('h1', {
                        key: 'title',
                        className: 'text-4xl md:text-6xl font-bold text-white mb-4 animate-fade-in'
                    }, t.title),
                    createElement('p', {
                        key: 'subtitle',
                        className: 'text-xl text-white/90 animate-fade-in'
                    }, t.subtitle),
                    // Language Toggle
                    createElement('div', {
                        key: 'language',
                        className: 'mt-6'
                    }, createElement('button', {
                        onClick: () => setLanguage(language === 'he' ? 'en' : 'he'),
                        className: 'px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all backdrop-blur-sm border border-white/30'
                    }, language === 'he' ? 'English' : '×¢×‘×¨×™×ª'))
                ]),

                // Main Content
                createElement('div', {
                    key: 'content',
                    className: 'max-w-7xl mx-auto'
                }, [
                    // Tab Navigation
                    createElement('div', {
                        key: 'tabs',
                        className: 'flex justify-center mb-8'
                    }, createElement('div', {
                        className: 'glass-effect rounded-xl p-2 inline-flex space-x-2'
                    }, [
                        createElement('button', {
                            key: 'basic',
                            onClick: () => setActiveTab('basic'),
                            className: `px-6 py-3 rounded-lg font-semibold transition-all ${
                                activeTab === 'basic'
                                    ? 'bg-purple-600 text-white shadow-lg'
                                    : 'text-purple-700 hover:bg-purple-100'
                            }`
                        }, t.basic),
                        createElement('button', {
                            key: 'advanced',
                            onClick: () => setActiveTab('advanced'),
                            className: `px-6 py-3 rounded-lg font-semibold transition-all ${
                                activeTab === 'advanced'
                                    ? 'bg-purple-600 text-white shadow-lg'
                                    : 'text-purple-700 hover:bg-purple-100'
                            }`
                        }, t.advanced)
                    ])),

                    // Tab Content
                    createElement('div', {
                        key: 'tab-content',
                        className: 'grid grid-cols-1 lg:grid-cols-3 gap-8'
                    }, [
                        // Forms Column
                        createElement('div', {
                            key: 'forms',
                            className: 'lg:col-span-2 space-y-6'
                        }, [
                            // Basic Form
                            activeTab === 'basic' && createElement(window.BasicInputs, {
                                key: 'basic-form',
                                inputs,
                                setInputs,
                                language,
                                t,
                                Calculator: () => createElement('span', {}, 'ðŸ“Š'),
                                PiggyBank: () => createElement('span', {}, 'ðŸ›ï¸'),
                                DollarSign: () => createElement('span', {}, 'ðŸ’°')
                            }),
                            // Advanced Form
                            activeTab === 'advanced' && createElement(window.AdvancedInputs, {
                                key: 'advanced-form',
                                inputs,
                                setInputs,
                                workPeriods,
                                setWorkPeriods,
                                partnerWorkPeriods,
                                setPartnerWorkPeriods,
                                pensionIndexAllocation,
                                setPensionIndexAllocation,
                                trainingFundIndexAllocation,
                                setTrainingFundIndexAllocation,
                                language,
                                t
                            })
                        ]),

                        // Results Column
                        createElement('div', {
                            key: 'results',
                            className: 'lg:col-span-1'
                        }, results && createElement(window.ResultsPanel, {
                            results,
                            language,
                            t,
                            chartData,
                            setChartData,
                            showChart,
                            setShowChart
                        }))
                    ])
                ])
            ]);
        };

        // Render the application with error boundary
        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        
        root.render(
            createElement(ErrorBoundary, {}, 
                createElement(App)
            )
        );
    </script>
</body>
</html>