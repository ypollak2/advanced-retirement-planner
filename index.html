<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Retirement Planner - Professional Pension Planning Tool</title>
    <meta name="description" content="Advanced retirement planning tool with index returns, risk levels, and accurate tax calculations">
    <meta name="keywords" content="retirement, pension planning, retirement calculator, pension savings, training fund, investment planning">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM from CDN with integrity -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Chart.js - More reliable charting library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .currency-format {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
        }
        
        /* RTL support */
        [dir="rtl"] .ml-2 { margin-left: 0; margin-right: 0.5rem; }
        [dir="rtl"] .mr-2 { margin-right: 0; margin-left: 0.5rem; }
        [dir="ltr"] .ml-2 { margin-left: 0.5rem; margin-right: 0; }
        [dir="ltr"] .mr-2 { margin-right: 0.5rem; margin-left: 0; }
    </style>
</head>
<body>
    <div id="root" class="min-h-screen gradient-bg"></div>
    
    <script>
        // Loading indicator while dependencies load
        document.addEventListener('DOMContentLoaded', function() {
            const root = document.getElementById('root');
            root.innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center">
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto mb-4"></div>
                        <p class="text-gray-600 text-lg">Loading Advanced Retirement Planner...</p>
                        <p class="text-gray-500 text-sm mt-2">Please wait while we load the application</p>
                    </div>
                </div>
            `;
        });

        // Check if dependencies are loaded
        function checkDependencies() {
            console.log('Checking dependencies...');
            console.log('React:', typeof React);
            console.log('ReactDOM:', typeof ReactDOM);
            console.log('Chart:', typeof Chart);
            
            const missing = [];
            if (typeof React === 'undefined') missing.push('React');
            if (typeof ReactDOM === 'undefined') missing.push('ReactDOM');
            if (typeof Chart === 'undefined') missing.push('Chart.js');
            
            if (missing.length > 0) {
                console.error('Missing dependencies:', missing);
                document.getElementById('root').innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 flex items-center justify-center p-4">
                        <div class="text-center max-w-md">
                            <div class="text-red-500 text-6xl mb-4">‚ö†Ô∏è</div>
                            <h2 class="text-2xl font-bold text-red-700 mb-4">Loading Error</h2>
                            <p class="text-gray-700 mb-4">
                                Missing dependencies: <strong>${missing.join(', ')}</strong>
                            </p>
                            <p class="text-gray-700 mb-4">
                                This might be due to:
                            </p>
                            <ul class="text-left text-gray-600 mb-4 space-y-1">
                                <li>‚Ä¢ Internet connectivity issues</li>
                                <li>‚Ä¢ CDN service interruption</li>
                                <li>‚Ä¢ Browser compatibility issues</li>
                            </ul>
                            <button onclick="location.reload()" class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-colors">
                                Retry Loading
                            </button>
                        </div>
                    </div>
                `;
                return false;
            }
            console.log('All dependencies loaded successfully!');
            return true;
        }

        // Wait for all dependencies to load
        const maxWaitTime = 10000; // 10 seconds
        let waitTime = 0;
        const checkInterval = setInterval(() => {
            if (checkDependencies()) {
                clearInterval(checkInterval);
                initializeApp();
            } else if (waitTime > maxWaitTime) {
                clearInterval(checkInterval);
                // Error message already shown by checkDependencies
            }
            waitTime += 100;
        }, 100);

        function initializeApp() {
            try {
                const { useState, useEffect } = React;
        
        // Simple Chart component using Chart.js
        const SimpleChart = ({ data, type = 'line' }) => {
            const chartRef = React.useRef(null);
            const chartInstance = React.useRef(null);
            
            React.useEffect(() => {
                if (chartRef.current && data && data.length > 0) {
                    const ctx = chartRef.current.getContext('2d');
                    
                    // Destroy existing chart
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                    
                    const chartData = {
                        labels: data.map(d => `Age ${d.age || d.name || d.year}`),
                        datasets: [{
                            label: 'Total Savings',
                            data: data.map(d => d.totalSavings || d.value),
                            borderColor: '#8B5CF6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            fill: true
                        }]
                    };
                    
                    chartInstance.current = new Chart(ctx, {
                        type: type,
                        data: chartData,
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Retirement Savings Progress'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '$' + (value / 1000).toFixed(0) + 'K';
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }, [data, type]);
            
            return React.createElement('canvas', { ref: chartRef, style: { maxHeight: '400px' } });
        };
        
        // Beautiful icon replacements with enhanced styling
        const Calculator = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'üìä');
        const TrendingUp = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'üìà');
        const Globe = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'üåç');
        const DollarSign = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'üí∞');
        const PiggyBank = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'üê∑');
        const AlertCircle = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, '‚ö†Ô∏è');
        const Plus = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, '‚ûï');
        const Trash2 = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'üóëÔ∏è');
        const Download = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, '‚¨áÔ∏è');
        const Languages = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'üåê');
        const Settings = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, '‚öôÔ∏è');
        const Info = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, '‚ÑπÔ∏è');
        const Target = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'üéØ');
        const Shuffle = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'üîÄ');
        const BarChart3 = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'üìä');
        const Percent = ({ size = 16, className = "" }) => React.createElement('span', { 
            className: className + " inline-flex items-center justify-center", 
            style: { fontSize: `${size}px` } 
        }, 'üìà');

        const RetirementPlanner = () => {
            const [language, setLanguage] = useState('he');
            const [activeTab, setActiveTab] = useState('basic');
            const [inputs, setInputs] = useState({
                currentAge: 30,
                retirementAge: 67,
                currentSavings: 50000,
                inflationRate: 3,
                currentMonthlyExpenses: 12000,
                targetReplacement: 75,
                riskTolerance: 'moderate',
                currentTrainingFund: 25000,
                trainingFundReturn: 6.5,
                trainingFundManagementFee: 0.5
            });

            const [pensionIndexAllocation, setPensionIndexAllocation] = useState([
                { index: 'S&P 500', percentage: 60, customReturn: null },
                { index: 'Government Bonds', percentage: 40, customReturn: null }
            ]);

            const [trainingFundIndexAllocation, setTrainingFundIndexAllocation] = useState([
                { index: 'Tel Aviv 35', percentage: 100, customReturn: null }
            ]);

            const [workPeriods, setWorkPeriods] = useState([
                {
                    id: 1,
                    country: 'israel',
                    startAge: 30,
                    endAge: 67,
                    monthlyContribution: 2000,
                    salary: 15000,
                    pensionReturn: 7.0,
                    pensionDepositFee: 0.5,
                    pensionAnnualFee: 0.8,
                    monthlyTrainingFund: 500
                }
            ]);

            const [results, setResults] = useState(null);
            const [chartData, setChartData] = useState(null);
            const [showChart, setShowChart] = useState(false);
            const [selectedTimeHorizon, setSelectedTimeHorizon] = useState(20);

            // Historical index returns data
            const historicalReturns = {
                5: {
                    'S&P 500': 12.8,
                    'NASDAQ': 14.2,
                    'MSCI World': 10.4,
                    'Dow Jones': 11.9,
                    'Tel Aviv 35': 8.5,
                    'Tel Aviv 125': 7.8,
                    'EUR STOXX 50': 7.2,
                    'FTSE 100': 6.8,
                    'Nikkei 225': 5.9,
                    'Local Index Fund': 6.2,
                    'Government Bonds': 4.1,
                    'Corporate Bonds': 5.3,
                    'Real Estate': 8.9
                },
                10: {
                    'S&P 500': 11.3,
                    'NASDAQ': 12.7,
                    'MSCI World': 9.1,
                    'Dow Jones': 10.8,
                    'Tel Aviv 35': 7.8,
                    'Tel Aviv 125': 7.2,
                    'EUR STOXX 50': 6.9,
                    'FTSE 100': 6.2,
                    'Nikkei 225': 8.4,
                    'Local Index Fund': 5.9,
                    'Government Bonds': 3.8,
                    'Corporate Bonds': 4.9,
                    'Real Estate': 8.1
                },
                15: {
                    'S&P 500': 10.8,
                    'NASDAQ': 11.9,
                    'MSCI World': 8.7,
                    'Dow Jones': 10.2,
                    'Tel Aviv 35': 7.3,
                    'Tel Aviv 125': 6.8,
                    'EUR STOXX 50': 6.1,
                    'FTSE 100': 5.9,
                    'Nikkei 225': 6.7,
                    'Local Index Fund': 5.6,
                    'Government Bonds': 3.5,
                    'Corporate Bonds': 4.6,
                    'Real Estate': 7.4
                },
                20: {
                    'S&P 500': 10.2,
                    'NASDAQ': 11.1,
                    'MSCI World': 8.2,
                    'Dow Jones': 9.8,
                    'Tel Aviv 35': 6.9,
                    'Tel Aviv 125': 6.4,
                    'EUR STOXX 50': 5.8,
                    'FTSE 100': 5.4,
                    'Nikkei 225': 4.9,
                    'Local Index Fund': 5.3,
                    'Government Bonds': 3.2,
                    'Corporate Bonds': 4.3,
                    'Real Estate': 7.0
                },
                25: {
                    'S&P 500': 9.8,
                    'NASDAQ': 10.6,
                    'MSCI World': 7.9,
                    'Dow Jones': 9.4,
                    'Tel Aviv 35': 6.5,
                    'Tel Aviv 125': 6.1,
                    'EUR STOXX 50': 5.5,
                    'FTSE 100': 5.1,
                    'Nikkei 225': 4.2,
                    'Local Index Fund': 5.0,
                    'Government Bonds': 2.9,
                    'Corporate Bonds': 4.0,
                    'Real Estate': 6.7
                },
                30: {
                    'S&P 500': 9.5,
                    'NASDAQ': 10.2,
                    'MSCI World': 7.6,
                    'Dow Jones': 9.1,
                    'Tel Aviv 35': 6.2,
                    'Tel Aviv 125': 5.8,
                    'EUR STOXX 50': 5.2,
                    'FTSE 100': 4.8,
                    'Nikkei 225': 3.8,
                    'Local Index Fund': 4.7,
                    'Government Bonds': 2.6,
                    'Corporate Bonds': 3.7,
                    'Real Estate': 6.4
                }
            };

            // Risk scenarios
            const riskScenarios = {
                veryConservative: { multiplier: 0.7, name: 'Very Conservative' },
                conservative: { multiplier: 0.85, name: 'Conservative' },
                moderate: { multiplier: 1.0, name: 'Moderate' },
                aggressive: { multiplier: 1.15, name: 'Aggressive' },
                veryAggressive: { multiplier: 1.3, name: 'Very Aggressive' }
            };

            // Translations
            const translations = {
                en: {
                    title: "üìä Advanced Retirement Planner",
                    subtitle: "Professional retirement planning tool with flexible returns and management fees",
                    basic: "Basic Data",
                    advanced: "Advanced Settings",
                    analysis: "Index Analysis",
                    scenarios: "Scenarios",
                    indexAllocation: "Index Allocation",
                    currentAge: "Current Age",
                    retirementAge: "Retirement Age",
                    currentSavings: "Current Pension Savings (‚Ç™)",
                    inflationRate: "Annual Inflation (%)",
                    currentMonthlyExpenses: "Current Monthly Expenses (‚Ç™)",
                    targetReplacement: "Target: Replace % of Salary",
                    riskTolerance: "Risk Level",
                    conservative: "Conservative",
                    moderate: "Moderate",
                    aggressive: "Aggressive",
                    workPeriods: "Work Periods üåç",
                    addPeriod: "Add Period",
                    monthlyIncome: "Monthly Retirement Income",
                    showChart: "Show Chart",
                    totalMonthly: "Total Monthly Income",
                    fromPension: "From Pension (After Tax)",
                    socialSecurity: "Social Security",
                    fromTrainingFund: "From Training Fund",
                    withInflation: "With Inflation:",
                    purchasingPower: "Today's Purchasing Power",
                    progressChart: "Savings Progress Over the Years üìä",
                    historicalReturns: "üìà Historical Average Returns in Leading Indices",
                    timeHorizon: "Time Horizon (years):",
                    useThisReturn: "Use This Return",
                    years: "years"
                },
                he: {
                    title: "üìä ◊û◊™◊õ◊†◊ü ◊î◊§◊†◊°◊ô◊î ◊î◊û◊™◊ß◊ì◊ù",
                    subtitle: "◊õ◊ú◊ô ◊™◊õ◊†◊ï◊ü ◊§◊†◊°◊ô◊î ◊û◊ß◊¶◊ï◊¢◊ô ◊¢◊ù ◊™◊©◊ï◊ê◊ï◊™ ◊ó◊ï◊§◊©◊ô◊ï◊™ ◊ï◊ì◊û◊ô ◊†◊ô◊î◊ï◊ú",
                    basic: "◊†◊™◊ï◊†◊ô◊ù ◊ë◊°◊ô◊°◊ô◊ô◊ù",
                    advanced: "◊î◊í◊ì◊®◊ï◊™ ◊û◊™◊ß◊ì◊û◊ï◊™",
                    analysis: "◊†◊ô◊™◊ï◊ó ◊û◊ì◊ì◊ô◊ù",
                    scenarios: "◊™◊®◊ó◊ô◊©◊ô◊ù",
                    indexAllocation: "◊î◊ß◊¶◊ê◊™ ◊û◊ì◊ì◊ô◊ù",
                    currentAge: "◊í◊ô◊ú ◊†◊ï◊õ◊ó◊ô",
                    retirementAge: "◊í◊ô◊ú ◊§◊®◊ô◊©◊î",
                    currentSavings: "◊ó◊ô◊°◊õ◊ï◊ü ◊†◊ï◊õ◊ó◊ô ◊ë◊§◊†◊°◊ô◊î (‚Ç™)",
                    inflationRate: "◊ê◊ô◊†◊§◊ú◊¶◊ô◊î ◊©◊†◊™◊ô◊™ (%)",
                    currentMonthlyExpenses: "◊î◊ï◊¶◊ê◊ï◊™ ◊ó◊ï◊ì◊©◊ô◊ï◊™ ◊†◊ï◊õ◊ó◊ô◊ï◊™ (‚Ç™)",
                    targetReplacement: "◊ô◊¢◊ì: ◊î◊ó◊ú◊§◊™ % ◊û◊î◊û◊©◊õ◊ï◊®◊™",
                    riskTolerance: "◊®◊û◊™ ◊°◊ô◊õ◊ï◊ü",
                    conservative: "◊©◊û◊®◊†◊ô",
                    moderate: "◊û◊™◊ï◊ü",
                    aggressive: "◊ê◊í◊®◊°◊ô◊ë◊ô",
                    workPeriods: "◊™◊ß◊ï◊§◊ï◊™ ◊¢◊ë◊ï◊ì◊î üåç",
                    addPeriod: "◊î◊ï◊°◊£ ◊™◊ß◊ï◊§◊î",
                    monthlyIncome: "◊î◊õ◊†◊°◊î ◊ë◊ô◊ì ◊ë◊§◊†◊°◊ô◊î",
                    showChart: "◊î◊¶◊í ◊í◊®◊£",
                    totalMonthly: "◊°◊î◊¥◊õ ◊ë◊ô◊ì ◊õ◊ú ◊ó◊ï◊ì◊©",
                    fromPension: "◊û◊î◊§◊†◊°◊ô◊î (◊ê◊ó◊®◊ô ◊û◊°)",
                    socialSecurity: "◊ë◊ô◊ò◊ï◊ó ◊ú◊ê◊ï◊û◊ô",
                    fromTrainingFund: "◊û◊ß◊®◊ü ◊î◊©◊™◊ú◊û◊ï◊™",
                    withInflation: "◊¢◊ù ◊ê◊ô◊†◊§◊ú◊¶◊ô◊î:",
                    purchasingPower: "◊õ◊ï◊ó ◊ß◊†◊ô◊ô◊î ◊©◊ú ◊î◊ô◊ï◊ù",
                    progressChart: "◊î◊™◊ß◊ì◊û◊ï◊™ ◊î◊ó◊ô◊°◊õ◊ï◊ü ◊ú◊ê◊ï◊®◊ö ◊î◊©◊†◊ô◊ù üìä",
                    historicalReturns: "üìà ◊û◊û◊ï◊¶◊¢ ◊™◊©◊ï◊ê◊ï◊™ ◊î◊ô◊°◊ò◊ï◊®◊ô◊ï◊™ ◊ë◊û◊ì◊ì◊ô◊ù ◊û◊ï◊ë◊ô◊ú◊ô◊ù",
                    timeHorizon: "◊ê◊ï◊§◊ß ◊ñ◊û◊ü (◊©◊†◊ô◊ù):",
                    useThisReturn: "◊î◊©◊™◊û◊© ◊ë◊™◊©◊ï◊ê◊î ◊ñ◊ï",
                    years: "◊©◊†◊ô◊ù"
                }
            };

            const t = translations[language];

            // Exchange rates
            const exchangeRates = {
                USD: 3.37,
                GBP: 4.60,
                EUR: 3.60
            };

            // Country data
            const countryData = {
                israel: {
                    name: 'Israel',
                    pensionTax: 0.15,
                    socialSecurity: 2500,
                    flag: 'üáÆüá±'
                },
                usa: {
                    name: 'USA',
                    pensionTax: 0.12,
                    socialSecurity: 1800,
                    flag: 'üá∫üá∏'
                },
                uk: {
                    name: 'UK',
                    pensionTax: 0.20,
                    socialSecurity: 1400,
                    flag: 'üá¨üáß'
                },
                germany: {
                    name: 'Germany',
                    pensionTax: 0.22,
                    socialSecurity: 1500,
                    flag: 'üá©üá™'
                },
                france: {
                    name: 'France',
                    pensionTax: 0.18,
                    socialSecurity: 1600,
                    flag: 'üá´üá∑'
                }
            };

            // Helper functions
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('he-IL', {
                    style: 'currency',
                    currency: 'ILS',
                    minimumFractionDigits: 0
                }).format(amount);
            };

            const convertCurrency = (amount, currency) => {
                const convertedAmount = amount / exchangeRates[currency];
                const formatters = {
                    USD: new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0 }),
                    GBP: new Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP', minimumFractionDigits: 0 }),
                    EUR: new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR', minimumFractionDigits: 0 })
                };
                return formatters[currency].format(convertedAmount);
            };

            const getNetReturn = (grossReturn, managementFee) => {
                return grossReturn - managementFee;
            };

            const calculateWeightedReturn = (allocations, timeHorizon = 20) => {
                let totalReturn = 0;
                let totalPercentage = 0;
                
                const availableTimeHorizons = [5, 10, 15, 20, 25, 30];
                const closestTimeHorizon = availableTimeHorizons.reduce((prev, curr) => 
                    Math.abs(curr - timeHorizon) < Math.abs(prev - timeHorizon) ? curr : prev
                );
                
                allocations.forEach(allocation => {
                    if (allocation.percentage > 0) {
                        const returnRate = allocation.customReturn !== null 
                            ? allocation.customReturn 
                            : (historicalReturns[closestTimeHorizon] && historicalReturns[closestTimeHorizon][allocation.index]) || 0;
                        
                        totalReturn += (returnRate * allocation.percentage / 100);
                        totalPercentage += allocation.percentage;
                    }
                });
                
                return totalPercentage > 0 ? totalReturn : 0;
            };

            const getAdjustedReturn = (baseReturn, riskLevel = inputs.riskTolerance) => {
                const riskMultiplier = riskScenarios[riskLevel]?.multiplier || 1.0;
                return baseReturn * riskMultiplier;
            };

            // Retirement calculation
            const calculateRetirement = () => {
                const yearsToRetirement = inputs.retirementAge - inputs.currentAge;
                
                if (yearsToRetirement <= 0) {
                    setResults(null);
                    return;
                }

                const basePensionWeightedReturn = calculateWeightedReturn(pensionIndexAllocation, yearsToRetirement);
                const baseTrainingFundWeightedReturn = calculateWeightedReturn(trainingFundIndexAllocation, yearsToRetirement);
                
                const pensionWeightedReturn = getAdjustedReturn(basePensionWeightedReturn);
                const trainingFundWeightedReturn = getAdjustedReturn(baseTrainingFundWeightedReturn);

                let totalPensionSavings = inputs.currentSavings;
                let totalTrainingFund = inputs.currentTrainingFund;
                let periodResults = [];
                
                const sortedPeriods = [...workPeriods].sort((a, b) => a.startAge - b.startAge);
                
                for (const period of sortedPeriods) {
                    const country = countryData[period.country];
                    const periodYears = Math.max(0, Math.min(period.endAge, inputs.retirementAge) - Math.max(period.startAge, inputs.currentAge));
                    
                    if (periodYears > 0) {
                        const adjustedPensionReturn = getAdjustedReturn(period.pensionReturn);
                        const effectiveReturn = adjustedPensionReturn - period.pensionAnnualFee;
                        const monthlyReturn = effectiveReturn / 100 / 12;
                        const periodMonths = periodYears * 12;
                        
                        const existingGrowth = totalPensionSavings * Math.pow(1 + monthlyReturn, periodMonths);
                        
                        const netMonthlyContribution = period.monthlyContribution * (1 - period.pensionDepositFee / 100);
                        const contributionsValue = netMonthlyContribution * (Math.pow(1 + monthlyReturn, periodMonths) - 1) / monthlyReturn;
                        
                        const newTotal = existingGrowth + contributionsValue;
                        
                        periodResults.push({
                            country: period.country,
                            countryName: country.name,
                            flag: country.flag,
                            years: periodYears,
                            contributions: period.monthlyContribution * periodMonths,
                            netContributions: netMonthlyContribution * periodMonths,
                            growth: newTotal - totalPensionSavings,
                            pensionReturn: adjustedPensionReturn,
                            pensionDepositFee: period.pensionDepositFee,
                            pensionAnnualFee: period.pensionAnnualFee,
                            pensionEffectiveReturn: effectiveReturn,
                            monthlyTrainingFund: period.monthlyTrainingFund
                        });
                        
                        totalPensionSavings = newTotal;
                    }
                }

                const adjustedTrainingFundReturn = getAdjustedReturn(inputs.trainingFundReturn);
                const trainingFundNetReturn = adjustedTrainingFundReturn - inputs.trainingFundManagementFee;
                
                totalTrainingFund = totalTrainingFund * Math.pow(1 + trainingFundNetReturn / 100, yearsToRetirement);
                
                for (const period of sortedPeriods) {
                    const periodYears = Math.max(0, Math.min(period.endAge, inputs.retirementAge) - Math.max(period.startAge, inputs.currentAge));
                    if (periodYears > 0) {
                        const monthlyReturn = trainingFundNetReturn / 100 / 12;
                        const periodMonths = periodYears * 12;
                        const contributionsValue = period.monthlyTrainingFund * (Math.pow(1 + monthlyReturn, periodMonths) - 1) / monthlyReturn;
                        totalTrainingFund += contributionsValue;
                    }
                }
                
                const monthlyPension = totalPensionSavings * 0.04 / 12;
                const monthlyTrainingFundIncome = totalTrainingFund * 0.05 / 12;
                
                let weightedTaxRate = 0;
                let totalWeight = 0;
                
                for (const result of periodResults) {
                    const country = countryData[result.country];
                    weightedTaxRate += country.pensionTax * result.growth;
                    totalWeight += result.growth;
                }
                
                if (totalWeight > 0) {
                    weightedTaxRate = weightedTaxRate / totalWeight;
                } else {
                    weightedTaxRate = countryData[workPeriods[0].country].pensionTax;
                }
                
                const pensionTax = monthlyPension * weightedTaxRate;
                const netPension = monthlyPension - pensionTax;
                const netTrainingFundIncome = monthlyTrainingFundIncome;
                
                const lastCountry = countryData[sortedPeriods[sortedPeriods.length - 1].country];
                const socialSecurity = lastCountry.socialSecurity;
                const totalNetIncome = netPension + netTrainingFundIncome + socialSecurity;

                const futureMonthlyExpenses = inputs.currentMonthlyExpenses * Math.pow(1 + inputs.inflationRate / 100, yearsToRetirement);
                const remainingAfterExpenses = totalNetIncome - futureMonthlyExpenses;

                const currentSalary = workPeriods.length > 0 ? workPeriods[workPeriods.length - 1].salary : 0;
                const targetMonthlyIncome = (currentSalary * inputs.targetReplacement) / 100;
                const achievesTarget = totalNetIncome >= targetMonthlyIncome;

                setResults({
                    totalSavings: Math.round(totalPensionSavings),
                    trainingFundValue: Math.round(totalTrainingFund),
                    monthlyPension: Math.round(monthlyPension),
                    monthlyTrainingFundIncome: Math.round(monthlyTrainingFundIncome),
                    pensionTax: Math.round(pensionTax),
                    netPension: Math.round(netPension),
                    netTrainingFundIncome: Math.round(netTrainingFundIncome),
                    socialSecurity: socialSecurity,
                    totalNetIncome: Math.round(totalNetIncome),
                    periodResults,
                    lastCountry,
                    weightedTaxRate: Math.round(weightedTaxRate * 100),
                    inflationAdjustedIncome: Math.round(totalNetIncome / Math.pow(1 + inputs.inflationRate / 100, yearsToRetirement)),
                    trainingFundNetReturn: trainingFundNetReturn,
                    pensionWeightedReturn: pensionWeightedReturn,
                    trainingFundWeightedReturn: trainingFundWeightedReturn,
                    futureMonthlyExpenses: Math.round(futureMonthlyExpenses),
                    remainingAfterExpenses: Math.round(remainingAfterExpenses),
                    remainingAfterExpensesInflationAdjusted: Math.round(remainingAfterExpenses / Math.pow(1 + inputs.inflationRate / 100, yearsToRetirement)),
                    targetMonthlyIncome: Math.round(targetMonthlyIncome),
                    achievesTarget: achievesTarget,
                    targetGap: Math.round(targetMonthlyIncome - totalNetIncome),
                    riskLevel: inputs.riskTolerance,
                    riskMultiplier: riskScenarios[inputs.riskTolerance]?.multiplier || 1.0
                });
            };

            // Chart generation
            const generateChartData = () => {
                const yearsToRetirement = inputs.retirementAge - inputs.currentAge;
                
                if (yearsToRetirement <= 0) {
                    setChartData([]);
                    setShowChart(false);
                    return;
                }

                const basePensionWeightedReturn = calculateWeightedReturn(pensionIndexAllocation, yearsToRetirement);
                const baseTrainingFundWeightedReturn = calculateWeightedReturn(trainingFundIndexAllocation, yearsToRetirement);
                
                const pensionWeightedReturn = getAdjustedReturn(basePensionWeightedReturn);
                const trainingFundWeightedReturn = getAdjustedReturn(baseTrainingFundWeightedReturn);

                const chartPoints = [];
                let accumulatedPensionSavings = inputs.currentSavings;
                let accumulatedTrainingFund = inputs.currentTrainingFund;
                
                chartPoints.push({
                    year: inputs.currentAge,
                    age: inputs.currentAge,
                    pensionSavings: accumulatedPensionSavings,
                    trainingFund: accumulatedTrainingFund,
                    totalSavings: accumulatedPensionSavings + accumulatedTrainingFund,
                    inflationAdjusted: accumulatedPensionSavings + accumulatedTrainingFund,
                    yearLabel: `Age ${inputs.currentAge}`
                });

                for (let yearOffset = 1; yearOffset <= yearsToRetirement; yearOffset++) {
                    const currentAge = inputs.currentAge + yearOffset;
                    
                    const activePeriod = workPeriods.find(period => 
                        currentAge > period.startAge && currentAge <= period.endAge
                    );
                    
                    if (activePeriod) {
                        const adjustedPensionReturn = getAdjustedReturn(activePeriod.pensionReturn);
                        const pensionEffectiveReturn = adjustedPensionReturn - activePeriod.pensionAnnualFee;
                        const netMonthlyContribution = activePeriod.monthlyContribution * (1 - activePeriod.pensionDepositFee / 100);
                        accumulatedPensionSavings = accumulatedPensionSavings * (1 + pensionEffectiveReturn / 100) + (netMonthlyContribution * 12);
                        
                        const adjustedTrainingFundReturn = getAdjustedReturn(inputs.trainingFundReturn);
                        const trainingFundNetReturn = (adjustedTrainingFundReturn - inputs.trainingFundManagementFee) / 100;
                        accumulatedTrainingFund = accumulatedTrainingFund * (1 + trainingFundNetReturn) + (activePeriod.monthlyTrainingFund * 12);
                    } else {
                        const adjustedBasicReturn = getAdjustedReturn(3);
                        accumulatedPensionSavings = accumulatedPensionSavings * (1 + adjustedBasicReturn / 100);
                        const adjustedTrainingFundReturn = getAdjustedReturn(inputs.trainingFundReturn);
                        const trainingFundNetReturn = (adjustedTrainingFundReturn - inputs.trainingFundManagementFee) / 100;
                        accumulatedTrainingFund = accumulatedTrainingFund * (1 + trainingFundNetReturn);
                    }
                    
                    const totalSavings = accumulatedPensionSavings + accumulatedTrainingFund;
                    const inflationAdjustedValue = totalSavings / Math.pow(1 + inputs.inflationRate / 100, yearOffset);
                    
                    chartPoints.push({
                        year: currentAge,
                        age: currentAge,
                        pensionSavings: Math.round(accumulatedPensionSavings),
                        trainingFund: Math.round(accumulatedTrainingFund),
                        totalSavings: Math.round(totalSavings),
                        inflationAdjusted: Math.round(inflationAdjustedValue),
                        yearLabel: `Age ${currentAge}`
                    });
                }

                setChartData(chartPoints);
                setShowChart(true);
            };

            // Update functions
            const addWorkPeriod = () => {
                const lastPeriod = workPeriods[workPeriods.length - 1];
                const newPeriod = {
                    id: Date.now(),
                    country: 'usa',
                    startAge: lastPeriod.endAge,
                    endAge: inputs.retirementAge,
                    monthlyContribution: 2000,
                    salary: 15000,
                    pensionReturn: 7.0,
                    pensionDepositFee: 0.5,
                    pensionAnnualFee: 0.8,
                    monthlyTrainingFund: 500
                };
                setWorkPeriods([...workPeriods, newPeriod]);
            };

            const removeWorkPeriod = (id) => {
                if (workPeriods.length > 1) {
                    setWorkPeriods(workPeriods.filter(period => period.id !== id));
                }
            };

            const updateWorkPeriod = (id, field, value) => {
                setWorkPeriods(workPeriods.map(period => 
                    period.id === id ? { ...period, [field]: value } : period
                ));
            };

            // Auto calculation
            useEffect(() => {
                calculateRetirement();
            }, [inputs, workPeriods, pensionIndexAllocation, trainingFundIndexAllocation]);

            useEffect(() => {
                if (showChart) {
                    generateChartData();
                }
            }, [inputs, workPeriods, showChart, pensionIndexAllocation, trainingFundIndexAllocation]);

            return React.createElement('div', {
                className: `min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-4 ${language === 'he' ? 'dir-rtl' : 'dir-ltr'}`,
                dir: language === 'he' ? 'rtl' : 'ltr'
            }, [
                React.createElement('div', { className: "max-w-7xl mx-auto" }, [
                    // Header
                    React.createElement('div', { className: "text-center mb-8 animate-fade-in" }, [
                        React.createElement('div', { className: "flex justify-center items-center gap-4 mb-4" }, [
                            React.createElement('div', { className: "flex items-center gap-3" }, [
                                React.createElement('div', { 
                                    className: "w-16 h-16 bg-gradient-to-br from-purple-600 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg transform rotate-3 hover:rotate-0 transition-transform duration-300"
                                }, [
                                    React.createElement('span', { 
                                        className: "text-2xl text-white font-bold" 
                                    }, "üí∞")
                                ]),
                                React.createElement('h1', { 
                                    className: "text-4xl font-bold bg-gradient-to-r from-purple-800 to-blue-800 bg-clip-text text-transparent"
                                }, t.title)
                            ]),
                            React.createElement('button', {
                                onClick: () => setLanguage(language === 'he' ? 'en' : 'he'),
                                className: "bg-gradient-to-r from-purple-500 to-blue-500 text-white px-4 py-2 rounded-lg flex items-center hover:from-purple-600 hover:to-blue-600 transition-all duration-300 shadow-lg"
                            }, [
                                React.createElement(Languages, { size: 20, className: "mr-2" }),
                                language === 'he' ? 'English' : '◊¢◊ë◊®◊ô◊™'
                            ])
                        ]),
                        React.createElement('p', { 
                            className: "text-lg text-gray-600 mb-6" 
                        }, t.subtitle),
                        
                        // Tabs
                        React.createElement('div', { className: "flex justify-center space-x-1 bg-white rounded-xl p-1 shadow-lg max-w-3xl mx-auto" }, [
                            { id: 'basic', icon: Calculator, label: t.basic },
                            { id: 'advanced', icon: Settings, label: t.advanced },
                            { id: 'analysis', icon: BarChart3, label: t.analysis },
                            { id: 'scenarios', icon: Target, label: t.scenarios }
                        ].map(tab => 
                            React.createElement('button', {
                                key: tab.id,
                                onClick: () => setActiveTab(tab.id),
                                className: `flex items-center px-6 py-3 rounded-lg transition-all duration-300 ${
                                    activeTab === tab.id
                                        ? 'bg-gradient-to-r from-purple-500 to-blue-500 text-white shadow-lg transform scale-105'
                                        : 'text-gray-600 hover:text-purple-700 hover:bg-purple-50'
                                }`
                            }, [
                                React.createElement(tab.icon, { size: 16, className: "mr-2" }),
                                tab.label
                            ])
                        ))
                    ]),

                    // Main Content
                    React.createElement('div', { className: "grid lg:grid-cols-3 gap-8" }, [
                        // Left Column - Input Forms
                        React.createElement('div', { className: "lg:col-span-2 space-y-6" }, [
                            activeTab === 'basic' && React.createElement('div', { className: "space-y-6" }, [
                                // Basic Data
                                React.createElement('div', { className: "glass-effect rounded-2xl shadow-xl p-6 border border-white/20 animate-fade-in" }, [
                                    React.createElement('h2', { className: "text-2xl font-bold text-purple-700 mb-6 flex items-center" }, [
                                        React.createElement(Calculator, { className: "mr-2" }),
                                        t.basic
                                    ]),
                                    React.createElement('div', { className: "space-y-4" }, [
                                        React.createElement('div', { className: "grid grid-cols-2 gap-4" }, [
                                            React.createElement('div', null, [
                                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, t.currentAge),
                                                React.createElement('input', {
                                                    type: 'number',
                                                    value: inputs.currentAge,
                                                    onChange: (e) => setInputs({...inputs, currentAge: parseInt(e.target.value) || 0}),
                                                    className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                                })
                                            ]),
                                            React.createElement('div', null, [
                                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, t.retirementAge),
                                                React.createElement('input', {
                                                    type: 'number',
                                                    value: inputs.retirementAge,
                                                    onChange: (e) => setInputs({...inputs, retirementAge: parseInt(e.target.value) || 0}),
                                                    className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                                })
                                            ])
                                        ]),
                                        React.createElement('div', { className: "grid grid-cols-2 gap-4" }, [
                                            React.createElement('div', null, [
                                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, t.currentSavings),
                                                React.createElement('input', {
                                                    type: 'number',
                                                    value: inputs.currentSavings,
                                                    onChange: (e) => setInputs({...inputs, currentSavings: parseInt(e.target.value) || 0}),
                                                    className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                                })
                                            ]),
                                            React.createElement('div', null, [
                                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, t.inflationRate),
                                                React.createElement('input', {
                                                    type: 'number',
                                                    step: '0.1',
                                                    value: inputs.inflationRate,
                                                    onChange: (e) => setInputs({...inputs, inflationRate: parseFloat(e.target.value) || 0}),
                                                    className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                                })
                                            ])
                                        ])
                                    ])
                                ]),
                                
                                // Work Periods
                                React.createElement('div', { className: "glass-effect rounded-2xl shadow-xl p-6 border border-white/20 animate-fade-in" }, [
                                    React.createElement('div', { className: "flex justify-between items-center mb-6" }, [
                                        React.createElement('h2', { className: "text-2xl font-bold text-blue-700 flex items-center" }, [
                                            React.createElement(Globe, { className: "mr-2" }),
                                            t.workPeriods
                                        ]),
                                        React.createElement('button', {
                                            onClick: addWorkPeriod,
                                            className: "bg-gradient-to-r from-blue-500 to-cyan-500 text-white px-4 py-2 rounded-lg flex items-center hover:from-blue-600 hover:to-cyan-600 transition-all shadow-lg"
                                        }, [
                                            React.createElement(Plus, { size: 16, className: "mr-1" }),
                                            t.addPeriod
                                        ])
                                    ]),
                                    React.createElement('div', { className: "space-y-4" }, 
                                        workPeriods.map((period, index) =>
                                            React.createElement('div', {
                                                key: period.id,
                                                className: "border border-gray-200 rounded-xl p-4 bg-gradient-to-r from-gray-50 to-blue-50 animate-fade-in"
                                            }, [
                                                React.createElement('div', { className: "flex justify-between items-center mb-3" }, [
                                                    React.createElement('h3', { className: "font-bold text-gray-800" }, `Period ${index + 1}`),
                                                    workPeriods.length > 1 && React.createElement('button', {
                                                        onClick: () => removeWorkPeriod(period.id),
                                                        className: "text-red-500 hover:text-red-700 hover:bg-red-100 p-1 rounded transition-all"
                                                    }, React.createElement(Trash2, { size: 16 }))
                                                ]),
                                                React.createElement('div', { className: "grid grid-cols-2 gap-3 mb-3" }, [
                                                    React.createElement('div', null, [
                                                        React.createElement('label', { className: "block text-xs font-medium text-gray-600 mb-1" }, "From Age"),
                                                        React.createElement('input', {
                                                            type: 'number',
                                                            value: period.startAge,
                                                            onChange: (e) => updateWorkPeriod(period.id, 'startAge', parseInt(e.target.value) || 0),
                                                            className: "w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500"
                                                        })
                                                    ]),
                                                    React.createElement('div', null, [
                                                        React.createElement('label', { className: "block text-xs font-medium text-gray-600 mb-1" }, "To Age"),
                                                        React.createElement('input', {
                                                            type: 'number',
                                                            value: period.endAge,
                                                            onChange: (e) => updateWorkPeriod(period.id, 'endAge', parseInt(e.target.value) || 0),
                                                            className: "w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500"
                                                        })
                                                    ])
                                                ]),
                                                React.createElement('div', { className: "mb-3" }, [
                                                    React.createElement('label', { className: "block text-xs font-medium text-gray-600 mb-1" }, "Country"),
                                                    React.createElement('select', {
                                                        value: period.country,
                                                        onChange: (e) => updateWorkPeriod(period.id, 'country', e.target.value),
                                                        className: "w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500"
                                                    }, Object.entries(countryData).map(([code, data]) =>
                                                        React.createElement('option', { key: code, value: code }, `${data.flag} ${data.name}`)
                                                    ))
                                                ]),
                                                React.createElement('div', { className: "grid grid-cols-2 gap-3" }, [
                                                    React.createElement('div', null, [
                                                        React.createElement('label', { className: "block text-xs font-medium text-gray-600 mb-1" }, "Monthly Contribution ($)"),
                                                        React.createElement('input', {
                                                            type: 'number',
                                                            value: period.monthlyContribution,
                                                            onChange: (e) => updateWorkPeriod(period.id, 'monthlyContribution', parseInt(e.target.value) || 0),
                                                            className: "w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500"
                                                        })
                                                    ]),
                                                    React.createElement('div', null, [
                                                        React.createElement('label', { className: "block text-xs font-medium text-gray-600 mb-1" }, "Salary ($)"),
                                                        React.createElement('input', {
                                                            type: 'number',
                                                            value: period.salary,
                                                            onChange: (e) => updateWorkPeriod(period.id, 'salary', parseInt(e.target.value) || 0),
                                                            className: "w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500"
                                                        })
                                                    ])
                                                ])
                                            ])
                                        )
                                    )
                                ])
                            ]),

                            activeTab === 'advanced' && React.createElement('div', { className: "space-y-6" }, [
                                // Advanced Settings
                                React.createElement('div', { className: "glass-effect rounded-2xl shadow-xl p-6 border border-white/20 animate-fade-in" }, [
                                    React.createElement('h2', { className: "text-2xl font-bold text-orange-700 mb-6 flex items-center" }, [
                                        React.createElement(Settings, { className: "mr-2" }),
                                        language === 'he' ? "◊î◊í◊ì◊®◊ï◊™ ◊û◊™◊ß◊ì◊û◊ï◊™" : "Advanced Settings"
                                    ]),
                                    React.createElement('div', { className: "space-y-4" }, [
                                        React.createElement('div', { className: "grid grid-cols-2 gap-4" }, [
                                            React.createElement('div', null, [
                                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, 
                                                    language === 'he' ? "◊î◊ï◊¶◊ê◊ï◊™ ◊ó◊ï◊ì◊©◊ô◊ï◊™ ◊†◊ï◊õ◊ó◊ô◊ï◊™ (‚Ç™)" : "Current Monthly Expenses (‚Ç™)"),
                                                React.createElement('input', {
                                                    type: 'number',
                                                    value: inputs.currentMonthlyExpenses,
                                                    onChange: (e) => setInputs({...inputs, currentMonthlyExpenses: parseInt(e.target.value) || 0}),
                                                    className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all"
                                                })
                                            ]),
                                            React.createElement('div', null, [
                                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, 
                                                    language === 'he' ? "◊ô◊¢◊ì: ◊î◊ó◊ú◊§◊™ % ◊û◊û◊©◊õ◊ï◊®◊™" : "Target: Replace % of Salary"),
                                                React.createElement('input', {
                                                    type: 'number',
                                                    value: inputs.targetReplacement,
                                                    onChange: (e) => setInputs({...inputs, targetReplacement: parseInt(e.target.value) || 0}),
                                                    className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all"
                                                })
                                            ])
                                        ]),
                                        React.createElement('div', null, [
                                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-3" }, 
                                                language === 'he' ? "◊®◊û◊™ ◊°◊ô◊õ◊ï◊ü" : "Risk Level"),
                                            React.createElement('div', { className: "grid grid-cols-5 gap-2" }, [
                                                'veryConservative', 'conservative', 'moderate', 'aggressive', 'veryAggressive'
                                            ].map(risk => {
                                                const labels = {
                                                    he: {
                                                        veryConservative: '◊©◊û◊®◊†◊ô ◊û◊ê◊ï◊ì',
                                                        conservative: '◊©◊û◊®◊†◊ô',
                                                        moderate: '◊û◊™◊ï◊ü',
                                                        aggressive: '◊ê◊í◊®◊°◊ô◊ë◊ô',
                                                        veryAggressive: '◊ê◊í◊®◊°◊ô◊ë◊ô ◊û◊ê◊ï◊ì'
                                                    },
                                                    en: {
                                                        veryConservative: 'Very Conservative',
                                                        conservative: 'Conservative',
                                                        moderate: 'Moderate',
                                                        aggressive: 'Aggressive',
                                                        veryAggressive: 'Very Aggressive'
                                                    }
                                                };
                                                const multipliers = {
                                                    veryConservative: '-30%',
                                                    conservative: '-15%',
                                                    moderate: '0%',
                                                    aggressive: '+15%',
                                                    veryAggressive: '+30%'
                                                };
                                                return React.createElement('button', {
                                                    key: risk,
                                                    onClick: () => setInputs({...inputs, riskTolerance: risk}),
                                                    className: `p-3 rounded-lg border-2 transition-all text-center ${
                                                        inputs.riskTolerance === risk 
                                                            ? 'border-orange-500 bg-orange-50 text-orange-700' 
                                                            : 'border-gray-200 bg-white hover:border-orange-300'
                                                    }`
                                                }, [
                                                    React.createElement('div', { className: "font-medium text-sm" }, labels[language][risk]),
                                                    React.createElement('div', { className: "text-xs text-gray-500 mt-1" }, multipliers[risk])
                                                ]);
                                            }))
                                        ])
                                    ])
                                ])
                            ]),

                            activeTab === 'scenarios' && React.createElement('div', { className: "glass-effect rounded-2xl shadow-xl p-6 border border-white/20 animate-fade-in" }, [
                                React.createElement('h2', { className: "text-2xl font-bold text-green-700 mb-6 flex items-center" }, [
                                    React.createElement(Target, { className: "mr-2" }),
                                    "◊™◊®◊ó◊ô◊©◊ô ◊°◊ô◊õ◊ï◊ü"
                                ]),
                                React.createElement('div', { className: "grid md:grid-cols-2 gap-6" }, 
                                    Object.entries(riskScenarios).map(([key, scenario]) =>
                                        React.createElement('div', {
                                            key: key,
                                            className: `p-4 rounded-xl border-2 transition-all cursor-pointer ${
                                                inputs.riskTolerance === key 
                                                    ? 'border-green-500 bg-green-50' 
                                                    : 'border-gray-200 bg-white hover:border-green-300'
                                            }`,
                                            onClick: () => setInputs({...inputs, riskTolerance: key})
                                        }, [
                                            React.createElement('h3', { className: "font-bold text-lg text-gray-800 mb-2" }, scenario.name),
                                            React.createElement('p', { className: "text-gray-600 mb-3" }, `◊û◊õ◊§◊ô◊ú ◊™◊©◊ï◊ê◊î: ${scenario.multiplier}x`),
                                            React.createElement('div', { className: "text-sm text-gray-500" }, 
                                                key === 'veryConservative' ? '◊°◊ô◊õ◊ï◊ü ◊†◊û◊ï◊ö ◊û◊ê◊ï◊ì, ◊™◊©◊ï◊ê◊î ◊†◊û◊ï◊õ◊î' :
                                                key === 'conservative' ? '◊°◊ô◊õ◊ï◊ü ◊†◊û◊ï◊ö, ◊™◊©◊ï◊ê◊î ◊û◊™◊ï◊†◊î' :
                                                key === 'moderate' ? '◊°◊ô◊õ◊ï◊ü ◊û◊™◊ï◊ü, ◊™◊©◊ï◊ê◊î ◊û◊û◊ï◊¶◊¢◊™' :
                                                key === 'aggressive' ? '◊°◊ô◊õ◊ï◊ü ◊í◊ë◊ï◊î, ◊™◊©◊ï◊ê◊î ◊í◊ë◊ï◊î◊î' :
                                                '◊°◊ô◊õ◊ï◊ü ◊í◊ë◊ï◊î ◊û◊ê◊ï◊ì, ◊™◊©◊ï◊ê◊î ◊í◊ë◊ï◊î◊î ◊û◊ê◊ï◊ì'
                                            )
                                        ])
                                    )
                                )
                            ]),

                            activeTab === 'analysis' && React.createElement('div', { className: "glass-effect rounded-2xl shadow-xl p-6 border border-white/20 animate-fade-in" }, [
                                React.createElement('h2', { className: "text-2xl font-bold text-blue-700 mb-6 flex items-center" }, [
                                    React.createElement(BarChart3, { className: "mr-2" }),
                                    t.historicalReturns
                                ]),
                                React.createElement('div', { className: "mb-6" }, [
                                    React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-3" }, t.timeHorizon),
                                    React.createElement('div', { className: "flex flex-wrap gap-2" }, [5, 10, 15, 20, 25, 30].map(years =>
                                        React.createElement('button', {
                                            key: years,
                                            onClick: () => setSelectedTimeHorizon(years),
                                            className: `px-4 py-2 rounded-lg transition-all ${
                                                selectedTimeHorizon === years
                                                    ? 'bg-blue-500 text-white shadow-lg'
                                                    : 'bg-gray-100 hover:bg-blue-100'
                                            }`
                                        }, `${years} ${t.years}`)
                                    ))
                                ]),
                                React.createElement('div', { className: "grid md:grid-cols-2 gap-4" }, 
                                    Object.entries(historicalReturns[selectedTimeHorizon]).map(([index, returnValue]) =>
                                        React.createElement('div', {
                                            key: index,
                                            className: "bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl p-4 border border-blue-200"
                                        }, [
                                            React.createElement('div', { className: "flex justify-between items-center mb-2" }, [
                                                React.createElement('h4', { className: "font-bold text-blue-800" }, index),
                                                React.createElement('div', { className: "text-2xl font-bold text-green-600" }, `${returnValue.toFixed(1)}%`)
                                            ]),
                                            React.createElement('div', { className: "text-sm text-gray-600 mb-3" }, `Average annual return (${selectedTimeHorizon} years)`),
                                            React.createElement('button', {
                                                onClick: () => {
                                                    setInputs({...inputs, trainingFundReturn: returnValue});
                                                    alert(`Training fund return updated to ${returnValue}%`);
                                                },
                                                className: "text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 transition-colors"
                                            }, t.useThisReturn)
                                        ])
                                    )
                                ),
                                // Chart
                                React.createElement('div', { className: "mt-6 h-64" },
                                    React.createElement(SimpleChart, { 
                                        data: Object.entries(historicalReturns[selectedTimeHorizon]).map(([name, value]) => ({ name, value })),
                                        type: 'bar'
                                    })
                                )
                            ])
                        ]),

                        // Right Column - Results
                        results && React.createElement('div', { className: "space-y-6" }, [
                            // Monthly Income
                            React.createElement('div', { className: "glass-effect rounded-2xl shadow-xl p-6 border border-white/20 animate-fade-in" }, [
                                React.createElement('div', { className: "flex justify-between items-center mb-6" }, [
                                    React.createElement('h2', { className: "text-2xl font-bold text-green-700 flex items-center" }, [
                                        React.createElement(PiggyBank, { className: "mr-2" }),
                                        t.monthlyIncome
                                    ]),
                                    React.createElement('button', {
                                        onClick: generateChartData,
                                        className: "bg-gradient-to-r from-green-500 to-teal-500 text-white px-4 py-2 rounded-lg flex items-center hover:from-green-600 hover:to-teal-600 transition-all shadow-lg"
                                    }, [
                                        React.createElement(TrendingUp, { size: 16, className: "mr-1" }),
                                        t.showChart
                                    ])
                                ]),
                                React.createElement('div', { className: "grid grid-cols-1 gap-4" }, [
                                    React.createElement('div', { className: "bg-gradient-to-r from-green-100 to-blue-100 rounded-xl p-4" }, [
                                        React.createElement('div', { className: "text-center" }, [
                                            React.createElement('div', { className: "text-3xl font-bold text-green-700 currency-format" }, formatCurrency(results.totalNetIncome)),
                                            React.createElement('div', { className: "text-sm text-gray-600" }, t.totalMonthly)
                                        ])
                                    ]),
                                    React.createElement('div', { className: "grid grid-cols-3 gap-2" }, [
                                        React.createElement('div', { className: "bg-blue-50 rounded-lg p-3" }, [
                                            React.createElement('div', { className: "text-lg font-bold text-blue-700 currency-format" }, formatCurrency(results.netPension)),
                                            React.createElement('div', { className: "text-xs text-gray-600" }, t.fromPension)
                                        ]),
                                        React.createElement('div', { className: "bg-green-50 rounded-lg p-3" }, [
                                            React.createElement('div', { className: "text-lg font-bold text-green-700 currency-format" }, formatCurrency(results.netTrainingFundIncome)),
                                            React.createElement('div', { className: "text-xs text-gray-600" }, t.fromTrainingFund)
                                        ]),
                                        React.createElement('div', { className: "bg-purple-50 rounded-lg p-3" }, [
                                            React.createElement('div', { className: "text-lg font-bold text-purple-700 currency-format" }, formatCurrency(results.socialSecurity)),
                                            React.createElement('div', { className: "text-xs text-gray-600" }, `${t.socialSecurity} ${results.lastCountry.flag}`)
                                        ])
                                    ]),
                                    React.createElement('div', { className: "bg-yellow-50 rounded-lg p-3 border-l-4 border-yellow-400" }, [
                                        React.createElement('div', { className: "flex items-center" }, [
                                            React.createElement(AlertCircle, { className: "text-yellow-600 mr-2", size: 16 }),
                                            React.createElement('div', null, [
                                                React.createElement('div', { className: "font-medium text-yellow-800" }, `${t.withInflation} ${formatCurrency(results.inflationAdjustedIncome)}`),
                                                React.createElement('div', { className: "text-xs text-yellow-600" }, t.purchasingPower)
                                            ])
                                        ])
                                    ]),
                                    // Currency conversion
                                    React.createElement('div', { className: "bg-gradient-to-r from-indigo-50 to-cyan-50 rounded-xl p-4 border border-indigo-200" }, [
                                        React.createElement('h4', { className: "font-bold text-indigo-800 mb-3 text-center" }, "üåç Currency Conversion"),
                                        React.createElement('div', { className: "grid grid-cols-2 gap-3" }, [
                                            React.createElement('div', { className: "bg-white/70 rounded-lg p-3 text-center" }, [
                                                React.createElement('div', { className: "text-sm text-gray-600" }, "US Dollar"),
                                                React.createElement('div', { className: "font-bold text-green-700 text-lg currency-format" }, convertCurrency(results.totalNetIncome, 'USD')),
                                                React.createElement('div', { className: "text-xs text-gray-500" }, `Rate: ${exchangeRates.USD}`)
                                            ]),
                                            React.createElement('div', { className: "bg-white/70 rounded-lg p-3 text-center" }, [
                                                React.createElement('div', { className: "text-sm text-gray-600" }, "British Pound"),
                                                React.createElement('div', { className: "font-bold text-green-700 text-lg currency-format" }, convertCurrency(results.totalNetIncome, 'GBP')),
                                                React.createElement('div', { className: "text-xs text-gray-500" }, `Rate: ${exchangeRates.GBP}`)
                                            ])
                                        ])
                                    ])
                                ])
                            ]),

                            // Savings Breakdown
                            React.createElement('div', { className: "glass-effect rounded-2xl shadow-xl p-6 border border-white/20 animate-fade-in" }, [
                                React.createElement('h3', { className: "text-xl font-bold text-blue-700 mb-4 flex items-center" }, [
                                    React.createElement(Calculator, { className: "mr-2" }),
                                    "Savings Breakdown"
                                ]),
                                React.createElement('div', { className: "space-y-3" }, [
                                    React.createElement('div', { className: "flex justify-between p-3 bg-blue-50 rounded-lg" }, [
                                        React.createElement('span', null, "Pension Savings:"),
                                        React.createElement('span', { className: "font-bold text-blue-700 currency-format" }, formatCurrency(results.totalSavings))
                                    ]),
                                    React.createElement('div', { className: "flex justify-between p-3 bg-green-50 rounded-lg" }, [
                                        React.createElement('span', null, "Training Fund:"),
                                        React.createElement('span', { className: "font-bold text-green-700 currency-format" }, formatCurrency(results.trainingFundValue))
                                    ]),
                                    React.createElement('div', { className: "flex justify-between p-3 bg-gray-50 rounded-lg border-2 border-gray-300" }, [
                                        React.createElement('span', { className: "font-bold" }, "Total Savings:"),
                                        React.createElement('span', { className: "font-bold text-gray-800 currency-format" }, formatCurrency(results.totalSavings + results.trainingFundValue))
                                    ])
                                ])
                            ]),

                            // Tax Breakdown
                            React.createElement('div', { className: "glass-effect rounded-2xl shadow-xl p-6 border border-white/20 animate-fade-in" }, [
                                React.createElement('h3', { className: "text-xl font-bold text-red-700 mb-4 flex items-center" }, [
                                    React.createElement(DollarSign, { className: "mr-2" }),
                                    "Tax Breakdown"
                                ]),
                                React.createElement('div', { className: "space-y-3" }, [
                                    React.createElement('div', { className: "flex justify-between p-3 bg-gray-50 rounded-lg" }, [
                                        React.createElement('span', null, "Gross Pension:"),
                                        React.createElement('span', { className: "font-bold currency-format" }, formatCurrency(results.monthlyPension))
                                    ]),
                                    React.createElement('div', { className: "flex justify-between p-3 bg-red-50 rounded-lg" }, [
                                        React.createElement('span', { className: "text-red-700" }, `Tax (${results.weightedTaxRate}%):`),
                                        React.createElement('span', { className: "font-bold text-red-700 currency-format" }, `-${formatCurrency(results.pensionTax)}`)
                                    ]),
                                    React.createElement('div', { className: "flex justify-between p-3 bg-green-50 rounded-lg border-2 border-green-200" }, [
                                        React.createElement('span', { className: "text-green-700 font-bold" }, "Net Amount:"),
                                        React.createElement('span', { className: "font-bold text-green-700 currency-format" }, formatCurrency(results.netPension))
                                    ])
                                ])
                            ])
                        ])
                    ]),

                    // Chart Section
                    results && showChart && chartData && chartData.length > 1 && React.createElement('div', { 
                        className: "mt-8 glass-effect rounded-2xl shadow-xl p-6 border border-white/20 animate-fade-in" 
                    }, [
                        React.createElement('h3', { className: "text-2xl font-bold text-purple-700 mb-6 flex items-center" }, [
                            React.createElement(TrendingUp, { className: "mr-2" }),
                            t.progressChart
                        ]),
                        React.createElement('div', { className: "h-96 mb-4" },
                            React.createElement(SimpleChart, { 
                                data: chartData,
                                type: 'line'
                            })
                        ),
                        React.createElement('div', { className: "bg-gray-50 rounded-lg p-4" }, [
                            React.createElement('div', { className: "grid md:grid-cols-2 gap-4 text-sm" }, [
                                React.createElement('div', { className: "flex items-start" }, [
                                    React.createElement('div', { className: "w-4 h-4 bg-gradient-to-r from-blue-500 to-blue-700 rounded mr-2 mt-1" }),
                                    React.createElement('div', null, [
                                        React.createElement('div', { className: "font-bold text-blue-700" }, "Pension"),
                                        React.createElement('div', { className: "text-gray-600" }, "Pension savings only")
                                    ])
                                ]),
                                React.createElement('div', { className: "flex items-start" }, [
                                    React.createElement('div', { className: "w-4 h-4 bg-gradient-to-r from-green-500 to-green-700 rounded mr-2 mt-1" }),
                                    React.createElement('div', null, [
                                        React.createElement('div', { className: "font-bold text-green-700" }, "Training Fund"),
                                        React.createElement('div', { className: "text-gray-600" }, "Training fund savings only")
                                    ])
                                ]),
                                React.createElement('div', { className: "flex items-start" }, [
                                    React.createElement('div', { className: "w-4 h-4 bg-gradient-to-r from-purple-500 to-purple-700 rounded mr-2 mt-1" }),
                                    React.createElement('div', null, [
                                        React.createElement('div', { className: "font-bold text-purple-700" }, "Total Nominal"),
                                        React.createElement('div', { className: "text-gray-600" }, "Actual amount that will accumulate")
                                    ])
                                ]),
                                React.createElement('div', { className: "flex items-start" }, [
                                    React.createElement('div', { className: "w-4 h-4 bg-gradient-to-r from-orange-500 to-orange-700 rounded mr-2 mt-1 opacity-70" }),
                                    React.createElement('div', null, [
                                        React.createElement('div', { className: "font-bold text-orange-700" }, "Inflation Adjusted"),
                                        React.createElement('div', { className: "text-gray-600" }, "Real purchasing power of money")
                                    ])
                                ])
                            ])
                        ])
                    ]),

                    // Footer
                    React.createElement('footer', { className: "mt-12 text-center" }, [
                        React.createElement('div', { className: "glass-effect rounded-xl p-6 border border-white/20" }, [
                            React.createElement('p', { className: "text-gray-600 mb-2" }, "üîß Advanced Retirement Planner - Professional Pension Planning Tool"),
                            React.createElement('p', { className: "text-sm text-gray-500" }, "‚ö†Ô∏è This information is for illustration purposes only and does not constitute professional financial advice. Consult with a qualified pension advisor."),
                            React.createElement('div', { className: "mt-4 flex justify-center items-center gap-4" }, [
                                React.createElement('a', {
                                    href: "https://github.com",
                                    target: "_blank",
                                    rel: "noopener noreferrer",
                                    className: "text-blue-600 hover:text-blue-800 transition-colors"
                                }, "üìÅ GitHub"),
                                React.createElement('span', { className: "text-gray-400" }, "|"),
                                React.createElement('span', { className: "text-gray-600" }, `¬© ${new Date().getFullYear()} Advanced Retirement Planner`)
                            ])
                        ])
                    ])
                ])
            ]);
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(RetirementPlanner));
        
        } catch (error) {
            console.error('Error initializing app:', error);
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 flex items-center justify-center p-4">
                    <div class="text-center max-w-md">
                        <div class="text-red-500 text-6xl mb-4">üí•</div>
                        <h2 class="text-2xl font-bold text-red-700 mb-4">Application Error</h2>
                        <p class="text-gray-700 mb-4">
                            An error occurred while loading the application:
                        </p>
                        <div class="bg-red-100 border border-red-300 rounded-lg p-3 mb-4">
                            <code class="text-red-700 text-sm">${error.message}</code>
                        </div>
                        <button onclick="location.reload()" class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-colors">
                            Reload Page
                        </button>
                    </div>
                </div>
            `;
        }
    }
    </script>
</body>
</html>