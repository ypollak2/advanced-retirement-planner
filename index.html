<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Retirement Planner - Professional Pension Planning Tool</title>
    <meta name="description" content="Advanced retirement planning tool with index returns, risk levels, and accurate tax calculations">
    <meta name="keywords" content="retirement, pension planning, retirement calculator, pension savings, training fund, investment planning">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM from CDN with integrity -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Chart.js - More reliable charting library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- CORS Proxy Solutions -->
    <script src="./cors-proxy-solution.js"></script>
    <script src="./yahoo-finance-cors-fix.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .currency-format {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
        }
        /* RTL support */
        [dir="rtl"] .ml-2 { margin-left: 0; margin-right: 0.5rem; }
        [dir="rtl"] .mr-2 { margin-right: 0; margin-left: 0.5rem; }
        [dir="ltr"] .ml-2 { margin-left: 0.5rem; margin-right: 0; }
        [dir="ltr"] .mr-2 { margin-right: 0.5rem; margin-left: 0; }
    </style>
</head>
<body>
    <div id="root" class="min-h-screen gradient-bg"></div>
    <!-- Load modules as scripts instead of ES6 imports for GitHub Pages compatibility -->
    <script src="./src/translations/multiLanguage.js?v=2.7.1"></script>
    <script src="./src/data/marketConstants.js?v=2.7.1"></script>
    <script src="./src/utils/retirementCalculations.js?v=2.7.1"></script>
    <script src="./src/utils/chartDataGenerator.js?v=2.7.1"></script>
    <script src="./src/components/FinancialChart.js?v=2.7.1"></script>
    <script src="./src/utils/analyticsTracker.js?v=2.7.1"></script>
    <script src="./src/utils/stressTestLogic.js?v=2.7.1"></script>
    <!-- Load main component files -->
    <script src="./src/components/RetirementPlannerApp.js?v=2.7.1"></script>
    <script src="./src/components/RetirementBasicForm.js?v=2.7.1"></script>
    <script src="./src/components/RetirementAdvancedForm.js?v=2.7.1"></script>
    <script src="./src/components/RetirementResultsPanel.js?v=2.7.1"></script>
    
    <script>
        // Define required modules array for testing
        window.requiredModules = [
            'multiLanguage',
            'countryData', 
            'calculateRetirement',
            'formatCurrency',
            'convertCurrency',
            'generateChartData',
            'AnalyticsManager',
            'stressTestScenarios',
            'BasicInputs',
            'AdvancedInputs', 
            'ResultsPanel',
            'RetirementPlannerApp',
            'SimpleChart'
        ];
        
        // Module loading verification function
        window.checkModulesLoaded = function() {
            const missing = window.requiredModules.filter(module => !window[module]);
            if (missing.length === 0) {
                console.log('✅ All required modules loaded successfully');
                return true;
            } else {
                console.warn('❌ Missing modules:', missing);
                return false;
            }
        };
    </script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const root = document.getElementById('root');
            root.innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center">
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto mb-4"></div>
                        <p class="text-gray-600 text-lg">Loading Advanced Retirement Planner...</p>
                        <p class="text-gray-500 text-sm mt-2">Please wait while we load the application</p>
                    </div>
                </div>
            `;
        });
        const safeValue = (value) => isNaN(value) || !isFinite(value) ? 0 : Math.max(0, value);
        function checkDependencies() {
            console.log('Checking dependencies...');
            console.log('React:', typeof React);
            console.log('ReactDOM:', typeof ReactDOM);
            console.log('Chart:', typeof Chart);
            const missing = [];
            if (typeof React === 'undefined') missing.push('React');
            if (typeof ReactDOM === 'undefined') missing.push('ReactDOM');
            if (typeof Chart === 'undefined') missing.push('Chart.js');
            if (missing.length > 0) {
                console.error('Missing dependencies:', missing);
                document.getElementById('root').innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 flex items-center justify-center p-4">
                        <div class="text-center max-w-md">
                            <div class="text-red-500 text-6xl mb-4">⚠️</div>
                            <h2 class="text-2xl font-bold text-red-700 mb-4">Loading Error</h2>
                            <p class="text-gray-700 mb-4">
                                Missing dependencies: <strong>${missing.join(', ')}</strong>
                            </p>
                            <p class="text-gray-700 mb-4">
                                This might be due to:
                            </p>
                            <ul class="text-left text-gray-600 mb-4 space-y-1">
                                <li>• Internet connectivity issues</li>
                                <li>• CDN service interruption</li>
                                <li>• Browser compatibility issues</li>
                            </ul>
                            <button id="retryBtn1" class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-colors">
                                Retry Loading
                            </button>
                        </div>
                    </div>
                `;
                setTimeout(() => {
                    const retryBtn = document.getElementById('retryBtn1');
                    if (retryBtn) {
                        retryBtn.addEventListener('click', () => location.reload());
                    }
                }, 100);
                return false;
            }
            console.log('All dependencies loaded successfully!');
            return true;
        }
        const maxWaitTime = 10000; // 10 seconds
        let waitTime = 0;
        const checkInterval = setInterval(() => {
            if (checkDependencies()) {
                clearInterval(checkInterval);
                initializeApp();
            } else if (waitTime > maxWaitTime) {
                clearInterval(checkInterval);
            }
            waitTime += 100;
        }, 100);
    </script>
    
    <!-- Load external application script -->
    <script src="./src/app.js?v=2.7.1"></script>
    
    <script>
        // Wait for dependencies and initialize app
        const maxWaitTime = 10000; // 10 seconds
        let waitTime = 0;
        const checkInterval = setInterval(() => {
            if (checkDependencies()) {
                clearInterval(checkInterval);
                if (window.initializeApp) {
                    window.initializeApp();
                } else {
                    console.error('initializeApp function not found');
                }
            } else if (waitTime > maxWaitTime) {
                clearInterval(checkInterval);
            }
            waitTime += 100;
        }, 100);
    </script>
</body>
</html>