<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Wizard Test Script</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        h1 {
            color: #333;
            margin: 0 0 20px 0;
        }
        .command-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            position: relative;
            overflow-x: auto;
        }
        .copy-btn {
            position: absolute;
            right: 10px;
            top: 10px;
            background: #28a745;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .copy-btn:hover {
            background: #218838;
        }
        .step {
            border-left: 4px solid #007bff;
            padding-left: 20px;
            margin: 20px 0;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .critical {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 10px 10px 0;
        }
        button:hover {
            background: #0056b3;
        }
        .keyword { color: #569cd6; }
        .string { color: #ce9178; }
        .number { color: #b5cea8; }
        .comment { color: #6a9955; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Complete Wizard Test Script</h1>
        <p>This script will start the wizard and test the financial health scoring from beginning to end.</p>
        
        <button onclick="window.open('https://ypollak2.github.io/advanced-retirement-planner/', '_blank')">
            Open Production App
        </button>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Important:</strong> Run these commands in order. Wait for each step to complete before proceeding to the next.
        </div>
    </div>

    <div class="container">
        <h2>Step-by-Step Commands</h2>
        
        <div class="step">
            <h3>Step 1: Start the Wizard</h3>
            <p>First, we need to initialize and start the wizard:</p>
            <div class="command-block" onclick="copyToClipboard(this)">
<span class="comment">// Start the retirement wizard</span>
<span class="keyword">if</span> (<span class="keyword">window</span>.retirementWizard) {
    <span class="comment">// If wizard exists, initialize it</span>
    <span class="keyword">window</span>.retirementWizard.initializeWizard();
    <span class="keyword">window</span>.retirementWizard.startWizard();
    console.log(<span class="string">'‚úÖ Wizard started'</span>);
} <span class="keyword">else</span> {
    <span class="comment">// Click the start button manually</span>
    <span class="keyword">const</span> startBtn = document.querySelector(<span class="string">'button'</span>);
    <span class="keyword">if</span> (startBtn) {
        startBtn.click();
        console.log(<span class="string">'‚úÖ Clicked start button'</span>);
    } <span class="keyword">else</span> {
        console.error(<span class="string">'‚ùå Could not find start button'</span>);
    }
}
                <button class="copy-btn">Copy</button>
            </div>
        </div>

        <div class="step">
            <h3>Step 2: Fill All Wizard Data at Once</h3>
            <p>This command fills all wizard fields with test data:</p>
            <div class="command-block" onclick="copyToClipboard(this)">
<span class="comment">// Fill all wizard data for a high-income individual</span>
<span class="keyword">function</span> fillWizardData() {
    <span class="keyword">const</span> testData = {
        <span class="comment">// Personal info</span>
        planningType: <span class="string">'individual'</span>,
        currentAge: <span class="number">35</span>,
        retirementAge: <span class="number">67</span>,
        country: <span class="string">'israel'</span>,
        
        <span class="comment">// Income</span>
        currentMonthlySalary: <span class="number">50000</span>,
        annualBonus: <span class="number">100000</span>,
        monthlyOtherIncome: <span class="number">0</span>,
        
        <span class="comment">// Expenses</span>
        currentMonthlyExpenses: <span class="number">25000</span>,
        
        <span class="comment">// Savings</span>
        currentPension: <span class="number">500000</span>,
        currentTrainingFund: <span class="number">300000</span>,
        currentPortfolio: <span class="number">200000</span>,
        currentRealEstate: <span class="number">0</span>,
        currentCrypto: <span class="number">0</span>,
        currentSavingsAccount: <span class="number">50000</span>,
        emergencyFund: <span class="number">150000</span>,
        
        <span class="comment">// Contributions</span>
        pensionEmployeeContribution: <span class="number">6</span>,
        pensionEmployerContribution: <span class="number">6.5</span>,
        pensionEmployerBenefitsContribution: <span class="number">6</span>,
        trainingFundEmployeeContribution: <span class="number">2.5</span>,
        trainingFundEmployerContribution: <span class="number">7.5</span>,
        
        <span class="comment">// Fees</span>
        pensionManagementFee: <span class="number">0.5</span>,
        pensionYearlyYield: <span class="number">7</span>,
        trainingFundManagementFee: <span class="number">0.5</span>,
        trainingFundYearlyYield: <span class="number">7</span>,
        
        <span class="comment">// Investment</span>
        riskTolerance: <span class="string">'balanced'</span>,
        expectedAnnualReturn: <span class="number">7</span>
    };
    
    <span class="comment">// Store in localStorage</span>
    localStorage.setItem(<span class="string">'retirementWizardInputs'</span>, JSON.stringify(testData));
    
    <span class="comment">// Update wizard if available</span>
    <span class="keyword">if</span> (<span class="keyword">window</span>.retirementWizard) {
        <span class="keyword">window</span>.retirementWizard.inputs = testData;
        <span class="keyword">window</span>.retirementWizard.loadProgress();
    }
    
    console.log(<span class="string">'‚úÖ Test data loaded'</span>);
    console.log(<span class="string">'üìä Expected score: 70-90 (NOT 27-29)'</span>);
    <span class="keyword">return</span> testData;
}

<span class="keyword">window</span>.testData = fillWizardData();
                <button class="copy-btn">Copy</button>
            </div>
        </div>

        <div class="step">
            <h3>Step 3: Navigate to Review Step</h3>
            <p>Jump directly to the review step:</p>
            <div class="command-block" onclick="copyToClipboard(this)">
<span class="comment">// Navigate to review step (step 9)</span>
<span class="keyword">if</span> (<span class="keyword">window</span>.retirementWizard) {
    <span class="keyword">window</span>.retirementWizard.currentStep = <span class="number">9</span>;
    <span class="keyword">window</span>.retirementWizard.updateUI();
    <span class="keyword">window</span>.retirementWizard.updateProgressBar();
    console.log(<span class="string">'‚úÖ Navigated to review step'</span>);
    
    <span class="comment">// Check if data is showing in review</span>
    setTimeout(() => {
        <span class="keyword">const</span> reviewContent = document.querySelector(<span class="string">'.review-content'</span>) || 
                            document.querySelector(<span class="string">'#step-9'</span>);
        <span class="keyword">if</span> (reviewContent) {
            console.log(<span class="string">'üìã Review content found'</span>);
        } <span class="keyword">else</span> {
            console.warn(<span class="string">'‚ö†Ô∏è Review content not found'</span>);
        }
    }, <span class="number">1000</span>);
} <span class="keyword">else</span> {
    console.error(<span class="string">'‚ùå Wizard not available'</span>);
}
                <button class="copy-btn">Copy</button>
            </div>
        </div>

        <div class="step">
            <h3>Step 4: Calculate Financial Health Score</h3>
            <p>Calculate and display the score:</p>
            <div class="command-block" onclick="copyToClipboard(this)">
<span class="comment">// Calculate financial health score</span>
<span class="keyword">function</span> calculateAndDisplayScore() {
    <span class="keyword">if</span> (!<span class="keyword">window</span>.calculateFinancialHealthScore) {
        console.error(<span class="string">'‚ùå calculateFinancialHealthScore function not found'</span>);
        <span class="keyword">return</span>;
    }
    
    <span class="comment">// Get the data</span>
    <span class="keyword">const</span> data = <span class="keyword">window</span>.testData || JSON.parse(localStorage.getItem(<span class="string">'retirementWizardInputs'</span>));
    
    <span class="comment">// Calculate score</span>
    <span class="keyword">const</span> result = <span class="keyword">window</span>.calculateFinancialHealthScore(data, {
        combinePartners: <span class="keyword">false</span>,
        debugMode: <span class="keyword">true</span>
    });
    
    console.log(<span class="string">'='</span>.repeat(<span class="number">50</span>));
    console.log(<span class="string">'üìä FINANCIAL HEALTH SCORE RESULTS'</span>);
    console.log(<span class="string">'='</span>.repeat(<span class="number">50</span>));
    console.log(<span class="string">`üéØ Total Score: ${result.totalScore}`</span>);
    console.log(<span class="string">`üìà Expected: 70-90`</span>);
    
    <span class="keyword">if</span> (result.totalScore >= <span class="number">27</span> && result.totalScore <= <span class="number">29</span>) {
        console.error(<span class="string">'‚ùå CRITICAL BUG DETECTED: Score is 27-29!'</span>);
        console.error(<span class="string">'The bug is STILL PRESENT in production!'</span>);
    } <span class="keyword">else if</span> (result.totalScore >= <span class="number">70</span> && result.totalScore <= <span class="number">90</span>) {
        console.log(<span class="string">'‚úÖ SUCCESS: Score is in expected range!'</span>);
        console.log(<span class="string">'The bug appears to be FIXED!'</span>);
    } <span class="keyword">else</span> {
        console.warn(<span class="string">`‚ö†Ô∏è WARNING: Score ${result.totalScore} is outside expected range`</span>);
    }
    
    console.log(<span class="string">'\nüìä Factor Scores:'</span>);
    <span class="keyword">if</span> (result.factorScores) {
        Object.entries(result.factorScores).forEach(([factor, data]) => {
            console.log(<span class="string">`- ${factor}: ${data.score}/${data.maxScore || '?'}`</span>);
        });
    }
    
    console.log(<span class="string">'='</span>.repeat(<span class="number">50</span>));
    
    <span class="keyword">return</span> result;
}

calculateAndDisplayScore();
                <button class="copy-btn">Copy</button>
            </div>
        </div>

        <div class="step">
            <h3>Step 5: Debug Field Mappings (Optional)</h3>
            <p>Check why scores might be wrong:</p>
            <div class="command-block" onclick="copyToClipboard(this)">
<span class="comment">// Debug field mappings and data flow</span>
console.log(<span class="string">'\nüîç DEBUGGING FIELD MAPPINGS'</span>);

<span class="comment">// Check saved data</span>
<span class="keyword">const</span> saved = localStorage.getItem(<span class="string">'retirementWizardInputs'</span>);
<span class="keyword">if</span> (saved) {
    <span class="keyword">const</span> data = JSON.parse(saved);
    console.log(<span class="string">'üì¶ Saved data fields:'</span>, Object.keys(data).length);
    
    <span class="comment">// Check critical fields</span>
    <span class="keyword">const</span> critical = [<span class="string">'currentMonthlySalary'</span>, <span class="string">'currentMonthlyExpenses'</span>, 
                     <span class="string">'currentPension'</span>, <span class="string">'emergencyFund'</span>];
    critical.forEach(field => {
        console.log(<span class="string">`${field}: ${data[field] !== undefined ? '‚úÖ ' + data[field] : '‚ùå Missing'}`</span>);
    });
}

<span class="comment">// Check field mapping bridge</span>
<span class="keyword">if</span> (<span class="keyword">window</span>.fieldMappingBridge) {
    console.log(<span class="string">'‚úÖ Field mapping bridge available'</span>);
} <span class="keyword">else</span> {
    console.log(<span class="string">'‚ùå Field mapping bridge NOT found'</span>);
}

<span class="comment">// Check wizard state</span>
<span class="keyword">if</span> (<span class="keyword">window</span>.retirementWizard) {
    console.log(<span class="string">`Current step: ${window.retirementWizard.currentStep}`</span>);
    console.log(<span class="string">`Input fields: ${Object.keys(window.retirementWizard.inputs || {}).length}`</span>);
}
                <button class="copy-btn">Copy</button>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>Expected Results</h2>
        
        <div class="success">
            <h3>‚úÖ If Bug is Fixed:</h3>
            <ul style="margin: 0; padding-left: 20px;">
                <li>Score will be between 70-90</li>
                <li>All factor scores will have reasonable values</li>
                <li>No "field not found" errors</li>
            </ul>
        </div>
        
        <div class="critical">
            <h3>‚ùå If Bug Still Exists:</h3>
            <ul style="margin: 0; padding-left: 20px;">
                <li>Score will be exactly 27-29</li>
                <li>Most factor scores will be 0</li>
                <li>Field mapping errors in console</li>
            </ul>
        </div>
    </div>

    <script>
        function copyToClipboard(element) {
            const codeBlock = element.cloneNode(true);
            const button = codeBlock.querySelector('.copy-btn');
            if (button) button.remove();
            
            const text = codeBlock.textContent.trim();
            
            navigator.clipboard.writeText(text).then(() => {
                const btn = element.querySelector('.copy-btn');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.style.background = '#28a745';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#28a745';
                }, 2000);
            }).catch(err => {
                alert('Failed to copy. Please select and copy manually.');
            });
        }
    </script>
</body>
</html>